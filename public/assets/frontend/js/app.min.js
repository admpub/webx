(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){module.exports=e}else{e(jQuery)}})(function($){var cachedLang=null;var htmlEncodeRegexp=/&|<|>| |\'|\"/g,htmlEncodeMapping={"&":"&amp;","<":"&lt;",">":"&gt;"," ":"&nbsp;","'":"&#39;",'"':"&quot;"};var htmlDecodeRegexp=/&amp;|&lt;|&gt;|&nbsp;|&#39;|&quot;/g,htmlDecodeMapping={"&amp;":"&","&lt;":"<","&gt;":">","&nbsp;":" ","&#39;":"'","&quot;":'"'};var textNl2brRegexp=/\n|  |\t/g,textNl2brMapping={"\n":"<br />","  ":"&nbsp; ","\t":"&nbsp; &nbsp; "};function getJQueryObject(e){return typeof e=="object"&&e instanceof jQuery?e:$(e)}window.App={clientID:{},i18n:{SYS_INFO:"System Information",UPLOAD_ERR:"Upload Error",PLEASE_SELECT_FOR_OPERATE:"Please select the item you want to operate",PLEASE_SELECT_FOR_REMOVE:"Please select the item you want to delete",CONFIRM_REMOVE:"Are you sure you want to delete them?",SELECTED_ITEMS:"You have selected %d items",SUCCESS:"The operation was successful",FAILURE:"Operation failed",UPLOADING:"File uploading, please wait...",UPLOAD_SUCCEED:"Upload successfully",BUTTON_UPLOAD:"Upload"},lang:"en",status:{CaptchaError:-9,CaptchaIdMissing:-10,CaptchaCodeRequired:-11,NonPrivileged:-2,NotLoggedIn:-1,Failure:0,Success:1},sprintf:sprintfWrapper.init,t:function(e){if(typeof App.i18n[e]=="undefined"){if(arguments.length<2)return e;return App.sprintf.apply(this,arguments)}if(arguments.length<2)return App.i18n[e];arguments[0]=App.i18n[e];return App.sprintf.apply(this,arguments)},langInfo:function(){if(cachedLang!=null)return cachedLang;var e=App.lang.split("-",2);cachedLang={encoding:e[0],country:""};if(e.length>1)cachedLang.country=e[1].toUpperCase();return cachedLang},langTag:function(e){var t=App.langInfo();if(t.country){if(e==null)e="-";return t.encoding+e+t.country}return t.encoding},htmlEncode:function(e){if(!e)return e;return String(e).replace(htmlEncodeRegexp,function(e){return htmlEncodeMapping[e]})},getJQueryObject:getJQueryObject,htmlDecode:function(e){if(!e)return e;return String(e).replace(htmlDecodeRegexp,function(e){return htmlDecodeMapping[e]})},dialog:function(){return BootstrapDialog},message:function(e,t){if(typeof e=="string"){switch(e){case"remove":var n=t;return $.gritter.remove(n);case"clear":return $.gritter.removeAll(t||{})}}var a={title:App.i18n.SYS_INFO,text:"",image:"",class_name:"clean",sticky:false};if(typeof e!="object")e={text:e,type:"clean"};if("type"in e&&e.type)e.class_name=e.type;e=$.extend({},a,e||{});switch(e.class_name){case"dark":case"primary":case"clean":case"info":if(e.title)e.title='<i class="fa fa-info-circle"></i> '+App.t(e.title);break;case"error":e.class_name="danger";case"danger":if(e.title)e.title='<i class="fa fa-comment-o"></i> '+App.t(e.title);break;case"warning":if(e.title)e.title='<i class="fa fa-warning"></i> '+App.t(e.title);break;case"success":if(e.title)e.title='<i class="fa fa-check"></i> '+App.t(e.title);break}if(t!=null)e.sticky=t;if(e.text)e.text=App.t(e.text);var n=$.gritter.add(e);return n},text2html:function(e,t){e=String(e);if(!t)e.replace(/<|>/g,function(e){return e=="<"?"&lt;":"&gt;"});return App.textNl2br(e)},ifTextNl2br:function(e){e=String(e);if(/<[^>]+>/.test(e))return e;return App.textNl2br(e)},textNl2br:function(e){return e.replace(textNl2brRegexp,function(e){return textNl2brMapping[e]})},trimSpace:function(e){return String(e).replace(/^[\s]+|[\s]+$/g,"")},checkedAll:function(e,t){return $(t).not(":disabled").prop("checked",$(e).prop("checked"))},attachCheckedAll:function(e,t,n){$(e).on("click",function(){App.checkedAll(this,t);if(n)$(n).text($(t+":checked").length)})},attachAjaxURL:function(e){if(e==null)e=document;$(e).on("click","[data-ajax-url]",function(){var a=$(this),e=a.data("ajax-confirm");if(a.data("processing")){alert(App.t("Processing, please wait for the operation to complete"));return}if(e&&!confirm(e))return;a.data("processing",true);var t=a.data("ajax-url"),n=a.data("ajax-method")||"get",r=a.data("ajax-params")||{},i=a.attr("title")||App.i18n.SYS_INFO,o=a.data("ajax-accept")||"html",s=a.data("ajax-target"),l=a.data("ajax-callback"),c=a.data("ajax-toggle"),p=a.data("ajax-onsuccess"),f=a.data("ajax-reload")||false;if(!i)i=a.text();var d=a.children(".fa");var u=c&&d.length>0;if(u){d.addClass("fa-spin")}else{App.loading("show")}a.trigger("processing");if(typeof r==="function")r=r.apply(this,arguments);$[n](t,r||{},function(e){a.data("processing",false);a.trigger("finished",arguments);if(u){d.removeClass("fa-spin")}else{App.loading("hide")}if(l)return l.apply(this,arguments);if(s){var t;if(o=="json"){if(e.Code!=1){return App.message({title:i,text:e.Info,type:"error",time:5e3,sticky:false})}t=e.Data}else{t=e}$(s).html(t);a.trigger("partial.loaded",arguments);$(s).trigger("partial.loaded",arguments);if(p)window.setTimeout(p,0);return}if(e.Code==1){if(p)window.setTimeout(p,2e3);if(f)window.setTimeout(function(){window.location.reload()},2e3)}if(o=="json"){return App.message({title:i,text:e.Info,type:e.Code==1?"success":"error",time:5e3,sticky:false})}App.message({title:i,text:e,time:5e3,sticky:false})},o).error(function(e,t,n){a.data("processing",false);a.trigger("finished",arguments);if(u){d.removeClass("fa-spin")}else{App.loading("hide")}App.message({title:i,text:e.responseText,type:"error",time:5e3,sticky:false})})})},attachPjax:function(e,t,r){if(!$.support.pjax)return;if(e==null)e="a";if(r==null)r=5e3;var n={onclick:null,onsend:null,oncomplete:null,ontimeout:null,onstart:null,onend:null};var i=$.extend({},n,t||{});$(document).on("click",e+"[data-pjax]",function(e){var t=$(this).data("pjax"),n=$(this).data("keepjs");var a=$(this).data("onclick");$.pjax.click(e,$(t),{timeout:r,keepjs:n});if(i.onclick)i.onclick(this);if(a&&typeof window[a]=="function")window[a](this)}).on("pjax:send",function(e,t,n){App.loading("show");if(i.onsend)i.onsend(e,t,n)}).on("pjax:complete",function(e,t,n,a){App.loading("hide");if(i.oncomplete)i.oncomplete(e,t,n,a)}).on("pjax:timeout",function(e,t,n){console.log("timeout");App.loading("hide");if(i.ontimeout)i.ontimeout(e,t,n)}).on("pjax:start",function(e,t,n){if(i.onstart)i.onstart(e,t,n)}).on("pjax:end",function(e,t,n){App.loading("hide");if(i.onend)i.onend(e,t,n);var a=n.container.attr("id");if(a){App.bottomFloat("#"+a+" .pagination");App.bottomFloat("#"+a+" .form-submit-group",0,true);$("#"+a+" .switch:not(.has-switch)").bootstrapSwitch()}if(n.type=="GET")$("#global-search-form").attr("action",n.url)})},loading:function(e,t){switch(e){case"show":NProgress.start();break;case"hide":NProgress.done();break;case"set":NProgress.set(t);break;case"inc":NProgress.inc(t);break}},insertAtCursor:function(e,t,n,a){if(typeof TextAreaEditor!="undefined"){TextAreaEditor.setSelectText(e,t,n,a);return}if(document.selection){e.focus();sel=document.selection.createRange();sel.text=t;sel.select()}else if(e.selectionStart||e.selectionStart=="0"){var r=e.selectionStart;var i=e.selectionEnd;var o=e.scrollTop;e.value=e.value.substring(0,r)+t+e.value.substring(i,e.value.length);if(o>0)e.scrollTop=o;e.focus();e.selectionStart=r+t.length;e.selectionEnd=r+t.length}else{e.value+=t;e.focus()}},wsURL:function(e){var t="ws:";if(window.location.protocol=="https:")t="wss:";var n=String(e).indexOf("//");if(n==-1){e=t+"//"+window.location.host+e}else{e=t+String(e).substring(n)}return e},websocket:function(t,e,n,a){if(!("WebSocket"in window))return;e=App.wsURL(e);var r=new WebSocket(e);r.onopen=function(e){console.log("Websocket Server is connected");if(n!=null&&$.isFunction(n))n.apply(this,arguments)};r.onclose=function(e){console.log("Websocket Server is disconnected");if(a!=null&&typeof a==="function")a.apply(this,arguments)};r.onmessage=function(e){if(t)t(e.data)};if(n!=null&&typeof n=="object"){r=$.extend({},r,n)}return r},notifyListen:function(e){if(e==null)e="/user/notice";var l={notify:0,element:0,modal:0},c={notify:20,element:50,modal:50},t=0;var n=App.websocket(function(e){var t=$.parseJSON(e);if(typeof App.clientID["notify"]=="undefined"){App.clientID["notify"]=t.client_id}switch(t.mode){case"-":break;case"element":var n=$("#notify-element-"+t.type);if(n.length<1){var a="recv_notice_"+t.type;if(typeof window[a]!="undefined"){return window[a](t)}if(t.status>0){console.info(t.content)}else{console.error(t.content)}return}if(l[t.mode]>=c[t.mode]){n.find("li:first").remove()}if(t.title){var r="badge-danger";if(t.status>0)r="badge-success";e='<span class="badge '+r+'">'+App.text2html(t.title)+"</span> "+App.text2html(t.content)}else{e=App.text2html(t.content)}n.append("<li>"+e+"</li>");l[t.mode]++;break;case"modal":var n=$("#notify-modal-"+t.type);if(n.length<1){var a="recv_notice_"+t.type;if(typeof window[a]!="undefined"){return window[a](t)}if(t.status>0){console.info(t.content)}else{console.error(t.content)}return}if(t.title){var r="badge-danger";if(t.status>0)r="badge-success";e='<span class="badge '+r+'">'+App.text2html(t.title)+"</span> "+App.text2html(t.content)}else{e=App.text2html(t.content)}if(!n.data("shown")){l[t.mode]=0;var i=n.find(".modal-body"),o=i.children("ul.modal-body-ul");if(o.length<1){i.html('<ul class="modal-body-ul" id="notify-modal-'+t.type+'-container"><li>'+e+"</li></ul>")}else{o.html("<li>"+e+"</li>")}App.dialog().show({id:"notify-modal-"+t.type,title:App.t("身份验证"),type:"type-primary",message:html,nl2br:false,closeByBackdrop:false,onshown:function(e){n.data("shown",true)},onhidden:function(e){n.data("shown",false)}})}else{var s=$("#notify-modal-"+t.type+"-container");if(l[t.mode]>=c[t.mode]){s.find("li:first").remove()}s.append("<li>"+e+"</li>")}l[t.mode]++;break;case"notify":default:if("notify"!=t.mode)t.mode="notify";var n=$("#notice-message-container");if(n.length<1){App.message({title:App.i18n.SYS_INFO,text:'<ul id="notice-message-container" class="no-list-style" style="max-height:500px;overflow-y:auto;overflow-x:hidden"></ul>',sticky:true});n=$("#notice-message-container")}if(l[t.mode]>=c[t.mode]){n.find("li:first").remove()}if(t.title){var r="badge-danger";if(t.status>0)r="badge-success";e='<span class="badge '+r+'">'+App.text2html(t.title)+"</span>"+App.text2html(t.content)}else{e=App.text2html(t.content)}n.append("<li>"+e+"</li>");l[t.mode]++;break}},e,null,function(){if(typeof CUSTOMER=="object"&&"ID"in CUSTOMER&&CUSTOMER.ID>0){$.post(FRONTEND_URL+"/customer_info",{},function(e){if(e.Code!=1)return;if(e.Data.online!="Y")return;window.setTimeout(function(){t++;try{n.close()}catch(e){}connectWS(function(){t=0})},5e3*(t+1))})}});return n},bottomFloat:function(e,i,o){if($(e).length<1)return;if(i==null)i=0;$(e).not("[disabled-fixed]").each(function(){var t=this;var e=$(t).height()+i;var n=$(t).offset().top+e;var a=$(t).outerWidth(),r=$(t).outerHeight();if(o||$(t).data("auto-width"))$(t).css("width",a);$(window).on("scroll",function(){var e=$(this).scrollTop()+$(window).height();if(e>=n){if($(t).hasClass("always-bottom")){$(t).removeClass("always-bottom");$(t).next(".fixed-placeholder").hide()}return}if(!$(t).hasClass("always-bottom")){$(t).addClass("always-bottom");if($(t).next(".fixed-placeholder").length>0){$(t).next(".fixed-placeholder").show()}else{$(t).after('<div style="width:'+a+"px;height:"+r+'px" class="fixed-placeholder"></div>')}}})});$(window).trigger("scroll")},getImgNaturalDimensions:function(e,t){if(e.naturalWidth){t({w:e.naturalWidth,h:e.naturalHeight});return}var n=new Image;n.onload=function(){t({w:n.width,h:n.height})};n.src=e.src},replaceURLParam:function(e,t,n){if(n==null)n=window.location.href;t=encodeURIComponent(t);var a=String(n).indexOf("?");if(a<0)return n+"?"+e+"="+t;var r=n.substring(a),i=new RegExp("([\\?&]"+e+"=)[^&]*(&|$)");if(!i.test(r))return n+"&"+e+"="+t;n=n.substring(0,a);r=r.replace(i,"$1"+t+"$2");return n+r},switchLang:function(e){window.location=App.replaceURLParam("lang",e)},tableSorting:function(e){e=e==null?"":e+" ";$(e+'[sort-current!=""]').each(function(){var e=String($(this).attr("sort-current"));var t=e.substring(0,1)=="-";if(t)e=e.substring(1);var n=$(this).find('[sort="'+e+'"]');var a,r,i;if(n.length<1&&e){n=$(this).find('[sort="-'+e+'"]')}if(!t){a="fa-arrow-up";i="up";r="fa-arrow-down"}else{a="fa-arrow-down";i="down";r="fa-arrow-up"}if(n.length>0){var o=n.children(".fa");if(o.length<1){n.append('<i class="fa '+a+'"></i>')}else{o.removeClass(r).addClass(a)}n.addClass("sort-active sort-"+i);n.siblings(".sort-active").removeClass("sort-active").removeClass("sort-up").removeClass("sort-down")}});$(e+"[sort-current] [sort]").css("cursor","pointer").on("click",function(e){var t=$(this).parents("[sort-current]");var n=t.attr("sort-current");var a=t.attr("sort-url")||window.location.href;var r=t.attr("sort-trigger");var i=$(this).attr("sort");if(n&&(n==i||n=="-"+i)){var o=/^\-/;n=o.test(n)?n.replace(o,""):"-"+n}else{n=i}a=App.replaceURLParam("sort",n,a);if(r){t.trigger("sort")}else{var s=t.attr("sort-setto");if(s){$(s).load(a)}else{window.location=a}}})},formatBytes:function(e,t){if(t==null)t=2;var n=["YB","ZB","EB","PB","TB","GB","MB","KB","B"];var a=n.length;for(a--;a>0&&e>1024;a--){e/=1024}return e.toFixed(t)+n[a]},progressMonitor:function(t,n){NProgress.start();var a=window.setInterval(function(){var e=t()/n;if(e>=1){NProgress.set(1);window.clearInterval(a)}else{NProgress.set(e)}},50)},float:function(e,t,n,a,r){if(!t)t="ajax";if(!n)n=t=="remind"?"rel":"src";if(!a)a="5-7";else{switch(a){case"bottom":a="5-7";break;case"right":a="8-6";break;case"top":a="7-5";break;case"left":a="6-8";break;case"left-bottom":a="2-4";break;case"right-bottom":a="1-3";break;case"left-top":a="3-1";break;case"right-top":a="4-2";break}}var i={targetMode:t,targetAttr:n,position:a};$(e).powerFloat($.extend(i,r||{}))},uploadPreviewer:function(e,t,n){if($(e).parent(".file-preview-shadow").length<1){var a={buttonText:'<i class="fa fa-cloud-upload"></i> '+App.i18n.BUTTON_UPLOAD,previewTableContainer:"#previewTableContainer",url:"",previewTableShow:false,uploadProgress:function(e){var t=e*100;if(t>100){$.LoadingOverlay("hide");return}$.LoadingOverlay("progress",t)}};var r=$.extend({},a,t||{});var i=$(e).uploadPreviewer(r);$(e).data("uploadPreviewer",i);$(e).on("file-preview:changed",function(e){var t={image:ASSETS_URL+"/images/nging-gear.png",text:App.i18n.UPLOADING};if(r.uploadProgress){t.progress=true;t.image=""}$.LoadingOverlay("show",t);i.submit(function(e){$.LoadingOverlay("hide");if(e.Code==1){App.message({text:App.i18n.UPLOAD_SUCCEED,type:"success"})}else{App.message({text:e.Info,type:"error"})}if(n!=null)n.call(this,e)})})}},showRequriedInputStar:function(){$("form:not([required-redstar])").each(function(){$(this).find("[required]").each(function(){var e=$(this).attr("id");if($("label[for="+e+"]").length>0){$("label[for="+e+"]").addClass("required");return}var t=$(this).parent(".input-group");if(t.length>0){t.addClass("required");return}t=$(this).parent('div[class*="col-"]');if(t.length>0){if(t.prev(".control-label").length>0){t.prev(".control-label").addClass("required");return}if(t.prev(".col-form-label").length>0){t.prev(".col-form-label").addClass("required");return}}var n=$(this).closest(".form-group");if(n.length<1)return;var a=n.children(".control-label:not(.required),.col-form-label:not(.required)");if(a.length<1)return;a.addClass("required")});$(this).attr("required-redstar","1")})},pushState:function(e,t,n){if(!window.history||!window.history.pushState)return;window.history.pushState(e,t,n)},replaceState:function(e,t,n){if(!window.history||!window.history.replaceState)return;window.history.replaceState(e,t,n)},formatJSON:function(e){e=$.trim(e);var t=e.substring(0,1);if(t=="["||t=="{"){var n=JSON.parse(e);e=JSON.stringify(n,null,"\t");return e}return""},formatJSONFromInnerHTML:function(e){if(e.data("jsonformatted"))return;e.data("jsonformatted",true);var t=App.formatJSON(e.html());if(t!="")e.html(t)},captchaUpdate:function($form,resp){if(!App.captchaHasError(resp.Code)||!resp.Data||typeof resp.Data.captchaType==="undefined")return;if(false==$form instanceof jQuery)$form=$($form);switch(resp.Data.captchaType){case"api":if(resp.Data.jsURL&&$('script[src="'+resp.Data.jsURL+'"]').length<1){$("body").append('<script src="'+resp.Data.jsURL+'" type="text/javascript"><\/script>');if(resp.Data.jsInit){eval(resp.Data.jsInit)}return}if(resp.Data.jsCallback){eval("("+resp.Data.jsCallback+")();")}break;default:var idElem=$form.find("input#"+resp.Data.captchaIdent);idElem.val(resp.Data.captchaID);idElem.siblings("img").attr("src",resp.Data.captchaURL);if(resp.Data.captchaName)$form.find('input[name="'+resp.Data.captchaName+'"]').focus()}},captchaHasError:function(e){return e>=-11&&e<=-9},fixedFooter:function(e,a){var t=$(e);if(t.length<1)return;var r=t.css("marginTop");if(a==null)a=$(".pos-fixed-top:first").height();var n=function(e){var t=e.position().top+e.height()+a;var n=$(window).height()-t;if(n>0)e.css("margin-top",n+"px");else if(n<0)e.css("margin-top",r)};n(t);$(window).on("resize",function(){n(t)})}};return window.App});