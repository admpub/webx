(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){module.exports=e}else{e(jQuery)}})(function(f){var t=null;window.App={clientID:{},i18n:{SYS_INFO:"System Information",UPLOAD_ERR:"Upload Error",PLEASE_SELECT_FOR_OPERATE:"Please select the item you want to operate",PLEASE_SELECT_FOR_REMOVE:"Please select the item you want to delete",CONFIRM_REMOVE:"Are you sure you want to delete them?",SELECTED_ITEMS:"You have selected %d items",SUCCESS:"The operation was successful",FAILURE:"Operation failed",UPLOADING:"File uploading, please wait...",UPLOAD_SUCCEED:"Upload successfully",BUTTON_UPLOAD:"Upload"},lang:"en",status:{CaptchaError:-9,CaptchaIdMissing:-10,CaptchaCodeRequired:-11,NonPrivileged:-2,NotLoggedIn:-1,Failure:0,Success:1},sprintf:sprintfWrapper.init,t:function(e){if(typeof App.i18n[e]=="undefined"){if(arguments.length<2)return e;return App.sprintf.apply(this,arguments)}if(arguments.length<2)return App.i18n[e];arguments[0]=App.i18n[e];return App.sprintf.apply(this,arguments)},langInfo:function(){if(t!=null)return t;var e=App.lang.split("-",2);t={encoding:e[0],country:""};if(e.length>1)t.country=e[1].toUpperCase();return t},langTag:function(e){var t=App.langInfo();if(t.country){if(e==null)e="-";return t.encoding+e+t.country}return t.encoding},dialog:function(){return BootstrapDialog},message:function(e,t){if(typeof e=="string"){switch(e){case"remove":var n=t;return f.gritter.remove(n);case"clear":return f.gritter.removeAll(t||{})}}var a={title:App.i18n.SYS_INFO,text:"",image:"",class_name:"clean",sticky:false};if(typeof e!="object")e={text:e,type:"clean"};if("type"in e&&e.type)e.class_name=e.type;e=f.extend({},a,e||{});switch(e.class_name){case"dark":case"primary":case"clean":case"info":if(e.title)e.title='<i class="fa fa-info-circle"></i> '+App.t(e.title);break;case"error":e.class_name="danger";case"danger":if(e.title)e.title='<i class="fa fa-comment-o"></i> '+App.t(e.title);break;case"warning":if(e.title)e.title='<i class="fa fa-warning"></i> '+App.t(e.title);break;case"success":if(e.title)e.title='<i class="fa fa-check"></i> '+App.t(e.title);break}if(t!=null)e.sticky=t;if(e.text)e.text=App.t(e.text);var n=f.gritter.add(e);return n},text2html:function(e){return String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />").replace(/  /g,"&nbsp; ").replace(/\t/g,"&nbsp; &nbsp; ")},ifTextNl2br:function(e){e=String(e);if(/<[^>]+>/.test(e))return e;return e.replace(/\n/g,"<br />").replace(/  /g,"&nbsp; ").replace(/\t/g,"&nbsp; &nbsp; ")},checkedAll:function(e,t){return f(t).not(":disabled").prop("checked",f(e).prop("checked"))},attachCheckedAll:function(e,t,n){f(e).on("click",function(){App.checkedAll(this,t);if(n)f(n).text(f(t+":checked").length)})},attachAjaxURL:function(){f(document).on("click","[data-ajax-url]",function(){var e=f(this).data("ajax-url"),t=f(this).attr("title");if(!t)t=f(this).text();f.get(e,{},function(e){App.message({title:t,text:e,time:5e3,sticky:false})},"html")})},attachPjax:function(e,t,i){if(!f.support.pjax)return;if(e==null)e="a";if(i==null)i=5e3;var n={onclick:null,onsend:null,oncomplete:null,ontimeout:null,onstart:null,onend:null};var r=f.extend({},n,t||{});f(document).on("click",e+"[data-pjax]",function(e){var t=f(this).data("pjax"),n=f(this).data("keepjs");var a=f(this).data("onclick");f.pjax.click(e,f(t),{timeout:i,keepjs:n});if(r.onclick)r.onclick(this);if(a&&typeof window[a]=="function")window[a](this)}).on("pjax:send",function(e,t,n){App.loading("show");if(r.onsend)r.onsend(e,t,n)}).on("pjax:complete",function(e,t,n,a){App.loading("hide");if(r.oncomplete)r.oncomplete(e,t,n,a)}).on("pjax:timeout",function(e,t,n){console.log("timeout");App.loading("hide");if(r.ontimeout)r.ontimeout(e,t,n)}).on("pjax:start",function(e,t,n){if(r.onstart)r.onstart(e,t,n)}).on("pjax:end",function(e,t,n){App.loading("hide");if(r.onend)r.onend(e,t,n);var a=n.container.attr("id");if(a){App.bottomFloat("#"+a+" .pagination");App.bottomFloat("#"+a+" .form-submit-group",0,true);f("#"+a+" .switch:not(.has-switch)").bootstrapSwitch()}if(n.type=="GET")f("#global-search-form").attr("action",n.url)})},loading:function(e,t){switch(e){case"show":NProgress.start();break;case"hide":NProgress.done();break;case"set":NProgress.set(t);break;case"inc":NProgress.inc(t);break}},insertAtCursor:function(e,t,n,a){if(typeof TextAreaEditor!="undefined"){TextAreaEditor.setSelectText(e,t,n,a);return}if(document.selection){e.focus();sel=document.selection.createRange();sel.text=t;sel.select()}else if(e.selectionStart||e.selectionStart=="0"){var i=e.selectionStart;var r=e.selectionEnd;var o=e.scrollTop;e.value=e.value.substring(0,i)+t+e.value.substring(r,e.value.length);if(o>0)e.scrollTop=o;e.focus();e.selectionStart=i+t.length;e.selectionEnd=i+t.length}else{e.value+=t;e.focus()}},wsURL:function(e){var t="ws:";if(window.location.protocol=="https:")t="wss:";var n=String(e).indexOf("//");if(n==-1){e=t+"//"+window.location.host+e}else{e=t+String(e).substring(n)}return e},websocket:function(t,e,n){e=App.wsURL(e);var a=new WebSocket(e);a.onopen=function(e){console.log("Websocket Server is connected");if(n!=null&&f.isFunction(n))n.apply(this,arguments)};a.onclose=function(e){console.log("Websocket Server is disconnected")};a.onmessage=function(e){t(e.data)};a.onerror=function(e){console.dir(e)};if(n!=null&&typeof n=="object"){a=f.extend({},a,n)}return a},notifyListen:function(e){if(e==null)e="/user/notice";var l={notify:0,element:0,modal:0},c={notify:20,element:50,modal:50};App.websocket(function(e){var t=f.parseJSON(e);if(typeof App.clientID["notify"]=="undefined"){App.clientID["notify"]=t.client_id}switch(t.mode){case"-":break;case"element":var n=f("#notify-element-"+t.type);if(n.length<1){var a="recv_notice_"+t.type;if(typeof window[a]!="undefined"){return window[a](t)}if(t.status>0){console.info(t.content)}else{console.error(t.content)}return}if(l[t.mode]>=c[t.mode]){n.find("li:first").remove()}if(t.title){var i="badge-danger";if(t.status>0)i="badge-success";e='<span class="badge '+i+'">'+App.text2html(t.title)+"</span> "+App.text2html(t.content)}else{e=App.text2html(t.content)}n.append("<li>"+e+"</li>");l[t.mode]++;break;case"modal":var n=f("#notify-modal-"+t.type);if(n.length<1){var a="recv_notice_"+t.type;if(typeof window[a]!="undefined"){return window[a](t)}if(t.status>0){console.info(t.content)}else{console.error(t.content)}return}if(t.title){var i="badge-danger";if(t.status>0)i="badge-success";e='<span class="badge '+i+'">'+App.text2html(t.title)+"</span> "+App.text2html(t.content)}else{e=App.text2html(t.content)}if(!n.data("shown")){l[t.mode]=0;var r=n.find(".modal-body"),o=r.children("ul.modal-body-ul");if(o.length<1){r.html('<ul class="modal-body-ul" id="notify-modal-'+t.type+'-container"><li>'+e+"</li></ul>")}else{o.html("<li>"+e+"</li>")}App.dialog().show({id:"notify-modal-"+t.type,title:App.t("身份验证"),type:"type-primary",message:html,nl2br:false,closeByBackdrop:false,onshown:function(e){n.data("shown",true)},onhidden:function(e){n.data("shown",false)}})}else{var s=f("#notify-modal-"+t.type+"-container");if(l[t.mode]>=c[t.mode]){s.find("li:first").remove()}s.append("<li>"+e+"</li>")}l[t.mode]++;break;case"notify":default:if("notify"!=t.mode)t.mode="notify";var n=f("#notice-message-container");if(n.length<1){App.message({title:App.i18n.SYS_INFO,text:'<ul id="notice-message-container" class="no-list-style" style="max-height:500px;overflow-y:auto;overflow-x:hidden"></ul>',sticky:true});n=f("#notice-message-container")}if(l[t.mode]>=c[t.mode]){n.find("li:first").remove()}if(t.title){var i="badge-danger";if(t.status>0)i="badge-success";e='<span class="badge '+i+'">'+App.text2html(t.title)+"</span>"+App.text2html(t.content)}else{e=App.text2html(t.content)}n.append("<li>"+e+"</li>");l[t.mode]++;break}},e)},bottomFloat:function(e,r,o){if(f(e).length<1)return;if(r==null)r=0;f(e).not("[disabled-fixed]").each(function(){var t=this;var e=f(t).height()+r;var n=f(t).offset().top+e;var a=f(t).outerWidth(),i=f(t).outerHeight();if(o||f(t).data("auto-width"))f(t).css("width",a);f(window).on("scroll",function(){var e=f(this).scrollTop()+f(window).height();if(e>=n){if(f(t).hasClass("always-bottom")){f(t).removeClass("always-bottom");f(t).next(".fixed-placeholder").hide()}return}if(!f(t).hasClass("always-bottom")){f(t).addClass("always-bottom");if(f(t).next(".fixed-placeholder").length>0){f(t).next(".fixed-placeholder").show()}else{f(t).after('<div style="width:'+a+"px;height:"+i+'px" class="fixed-placeholder"></div>')}}})});f(window).trigger("scroll")},getImgNaturalDimensions:function(e,t){if(!e.naturalWidth){t({w:e.naturalWidth,h:e.naturalHeight});return}var n=new Image;n.onload=function(){t({w:n.width,h:n.height})};n.src=e.src},replaceURLParam:function(e,t,n){if(n==null)n=window.location.href;t=encodeURIComponent(t);var a=String(n).indexOf("?");if(a<0)return n+"?"+e+"="+t;var i=n.substring(a),r=new RegExp("([\\?&]"+e+"=)[^&]*(&|$)");if(!r.test(i))return n+"&"+e+"="+t;n=n.substring(0,a);i=i.replace(r,"$1"+t+"$2");return n+i},switchLang:function(e){window.location=App.replaceURLParam("lang",e)},tableSorting:function(e){e=e==null?"":e+" ";f(e+'[sort-current!=""]').each(function(){var e=String(f(this).attr("sort-current"));var t=e.substring(0,1)=="-";if(t)e=e.substring(1);var n=f(this).find('[sort="'+e+'"]');var a,i,r;if(n.length<1&&e){n=f(this).find('[sort="-'+e+'"]')}if(!t){a="fa-arrow-up";r="up";i="fa-arrow-down"}else{a="fa-arrow-down";r="down";i="fa-arrow-up"}if(n.length>0){var o=n.children(".fa");if(o.length<1){n.append('<i class="fa '+a+'"></i>')}else{o.removeClass(i).addClass(a)}n.addClass("sort-active sort-"+r);n.siblings(".sort-active").removeClass("sort-active").removeClass("sort-up").removeClass("sort-down")}});f(e+"[sort-current] [sort]").css("cursor","pointer").on("click",function(e){var t=f(this).parents("[sort-current]");var n=t.attr("sort-current");var a=t.attr("sort-url")||window.location.href;var i=t.attr("sort-trigger");var r=f(this).attr("sort");if(n&&(n==r||n=="-"+r)){var o=/^\-/;n=o.test(n)?n.replace(o,""):"-"+n}else{n=r}a=App.replaceURLParam("sort",n,a);if(i){t.trigger("sort")}else{var s=t.attr("sort-setto");if(s){f(s).load(a)}else{window.location=a}}})},formatBytes:function(e,t){if(t==null)t=2;var n=["YB","ZB","EB","PB","TB","GB","MB","KB","B"];var a=n.length;for(a--;a>0&&e>1024;a--){e/=1024}return e.toFixed(t)+n[a]},progressMonitor:function(t,n){NProgress.start();var a=window.setInterval(function(){var e=t()/n;if(e>=1){NProgress.set(1);window.clearInterval(a)}else{NProgress.set(e)}},50)},float:function(e,t,n,a,i){if(!t)t="ajax";if(!n)n=t=="remind"?"rel":"src";if(!a)a="5-7";else{switch(a){case"bottom":a="5-7";break;case"right":a="8-6";break;case"top":a="7-5";break;case"left":a="6-8";break;case"left-bottom":a="2-4";break;case"right-bottom":a="1-3";break;case"left-top":a="3-1";break;case"right-top":a="4-2";break}}var r={targetMode:t,targetAttr:n,position:a};f(e).powerFloat(f.extend(r,i||{}))},uploadPreviewer:function(e,t,n){if(f(e).parent(".file-preview-shadow").length<1){var a={buttonText:'<i class="fa fa-cloud-upload"></i> '+App.i18n.BUTTON_UPLOAD,previewTableContainer:"#previewTableContainer",url:"",previewTableShow:false,uploadProgress:function(e){var t=e*100;if(t>100){f.LoadingOverlay("hide");return}f.LoadingOverlay("progress",t)}};var i=f.extend({},a,t||{});var r=f(e).uploadPreviewer(i);f(e).data("uploadPreviewer",r);f(e).on("file-preview:changed",function(e){var t={image:ASSETS_URL+"/images/nging-gear.png",text:App.i18n.UPLOADING};if(i.uploadProgress){t.progress=true;t.image=""}f.LoadingOverlay("show",t);r.submit(function(e){f.LoadingOverlay("hide");if(e.Code==1){App.message({text:App.i18n.UPLOAD_SUCCEED,type:"success"})}else{App.message({text:e.Info,type:"error"})}if(n!=null)n.call(this,e)})})}},showRequriedInputStar:function(){f("form:not([required-redstar])").each(function(){f(this).find("[required]").each(function(){var e=f(this).attr("id");if(f("label[for="+e+"]").length>0){f("label[for="+e+"]").addClass("required");return}var t=f(this).parent(".input-group");if(t.length>0){t.addClass("required");return}t=f(this).parent('div[class*="col-"]');if(t.length>0){if(t.prev(".control-label").length>0){t.prev(".control-label").addClass("required");return}if(t.prev(".col-form-label").length>0){t.prev(".col-form-label").addClass("required");return}}var n=f(this).closest(".form-group");if(n.length<1)return;var a=n.children(".control-label:not(.required),.col-form-label:not(.required)");if(a.length<1)return;a.addClass("required")});f(this).attr("required-redstar","1")})},pushState:function(e,t,n){if(!window.history||!window.history.pushState)return;window.history.pushState(e,t,n)},replaceState:function(e,t,n){if(!window.history||!window.history.replaceState)return;window.history.replaceState(e,t,n)},formatJSON:function(e){e=f.trim(e);var t=e.substring(0,1);if(t=="["||t=="{"){var n=JSON.parse(e);e=JSON.stringify(n,null,"\t");return e}return""},formatJSONFromInnerHTML:function(e){if(e.data("jsonformatted"))return;e.data("jsonformatted",true);var t=App.formatJSON(e.html());if(t!="")e.html(t)},captchaUpdate:function(e,t){if(App.captchaHasError(t.Code)&&t.Data&&typeof t.Data.captchaIdent!=="undefined"){if(false==e instanceof jQuery)e=f(e);var n=e.find("input#"+t.Data.captchaIdent);n.val(t.Data.captchaID);n.siblings("img").attr("src",t.Data.captchaURL);if(t.Data.captchaName)e.find('input[name="'+t.Data.captchaName+'"]').focus()}},captchaHasError:function(e){return e>=-11&&e<=-9}};return window.App});