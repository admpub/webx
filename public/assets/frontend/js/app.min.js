(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){module.exports=e}else{e(jQuery)}})(function($){var cachedLang=null;var htmlEncodeRegexp=/&|<|>| |\'|\"/g,htmlEncodeMapping={"&":"&amp;","<":"&lt;",">":"&gt;"," ":"&nbsp;","'":"&#39;",'"':"&quot;"};var htmlDecodeRegexp=/&amp;|&lt;|&gt;|&nbsp;|&#39;|&quot;/g,htmlDecodeMapping={"&amp;":"&","&lt;":"<","&gt;":">","&nbsp;":" ","&#39;":"'","&quot;":'"'};var textNl2brRegexp=/\n|  |\t/g,textNl2brMapping={"\n":"<br />","  ":"&nbsp; ","\t":"&nbsp; &nbsp; "};function getJQueryObject(e){return typeof e=="object"&&e instanceof jQuery?e:$(e)}window.App={clientID:{},i18n:{SYS_INFO:"System Information",UPLOAD_ERR:"Upload Error",PLEASE_SELECT_FOR_OPERATE:"Please select the item you want to operate",PLEASE_SELECT_FOR_REMOVE:"Please select the item you want to delete",CONFIRM_REMOVE:"Are you sure you want to delete them?",SELECTED_ITEMS:"You have selected %d items",SUCCESS:"The operation was successful",FAILURE:"Operation failed",UPLOADING:"File uploading, please wait...",UPLOAD_SUCCEED:"Upload successfully",BUTTON_UPLOAD:"Upload"},lang:"en",status:{CaptchaError:-9,CaptchaIdMissing:-10,CaptchaCodeRequired:-11,NonPrivileged:-2,NotLoggedIn:-1,Failure:0,Success:1},sprintf:sprintfWrapper.init,t:function(e){if(typeof App.i18n[e]=="undefined"){if(e.startsWith("#")){var t=e.substring(1),n=t.indexOf("#");if(n>1){e=t.substring(n+1);arguments[0]=e}}if(arguments.length<2)return e;return App.sprintf.apply(this,arguments)}if(arguments.length<2)return App.i18n[e];arguments[0]=App.i18n[e];return App.sprintf.apply(this,arguments)},langInfo:function(){if(cachedLang!=null)return cachedLang;var e=App.lang.split("-",2);cachedLang={encoding:e[0],country:""};if(e.length>1)cachedLang.country=e[1].toUpperCase();return cachedLang},langTag:function(e){var t=App.langInfo();if(t.country){if(e==null)e="-";return t.encoding+e+t.country}return t.encoding},htmlEncode:function(e){if(!e)return e;return String(e).replace(htmlEncodeRegexp,function(e){return htmlEncodeMapping[e]})},getJQueryObject:getJQueryObject,htmlDecode:function(e){if(!e)return e;return String(e).replace(htmlDecodeRegexp,function(e){return htmlDecodeMapping[e]})},dialog:function(){return BootstrapDialog},message:function(e,t){if(typeof e=="string"){switch(e){case"remove":var n=t;return $.gritter.remove(n);case"clear":return $.gritter.removeAll(t||{})}}var i={title:App.i18n.SYS_INFO,text:"",image:"",class_name:"clean",sticky:false};if(typeof e!="object")e={text:e,type:"clean"};if("type"in e&&e.type)e.class_name=e.type;e=$.extend({},i,e||{});switch(e.class_name){case"dark":case"primary":case"clean":case"info":if(e.title)e.title='<i class="fa fa-info-circle"></i> '+App.t(e.title);break;case"error":e.class_name="danger";case"danger":if(e.title)e.title='<i class="fa fa-comment-o"></i> '+App.t(e.title);break;case"warning":if(e.title)e.title='<i class="fa fa-warning"></i> '+App.t(e.title);break;case"success":if(e.title)e.title='<i class="fa fa-check"></i> '+App.t(e.title);break}if(t!=null)e.sticky=t;if(e.text)e.text=App.t(e.text);var n=$.gritter.add(e);return n},text2html:function(e,t){e=String(e);if(!t)e.replace(/<|>/g,function(e){return e=="<"?"&lt;":"&gt;"});return App.textNl2br(e)},ifTextNl2br:function(e){e=String(e);if(/<[^>]+>/.test(e))return e;return App.textNl2br(e)},textNl2br:function(e){return e.replace(textNl2brRegexp,function(e){return textNl2brMapping[e]})},trimSpace:function(e){return String(e).replace(/^[\s]+|[\s]+$/g,"")},checkedAll:function(e,t){return $(t).not(":disabled").prop("checked",$(e).prop("checked"))},attachCheckedAll:function(e,t,n){$(e).on("click",function(){App.checkedAll(this,t);if(n)$(n).text($(t+":checked").length)})},attachAjaxURL:function(e){if(e==null)e=document;$(e).on("click","[data-ajax-url]",function(){var i=$(this),e=i.data("ajax-confirm");if(i.data("processing")){alert(App.t("Processing, please wait for the operation to complete"));return}if(e&&!confirm(e))return;i.data("processing",true);var t=i.data("ajax-url"),n=i.data("ajax-method")||"get",a=i.data("ajax-params")||{},r=i.attr("title")||App.i18n.SYS_INFO,o=i.data("ajax-accept")||"html",s=i.data("ajax-target"),l=i.data("ajax-callback"),c=i.data("ajax-toggle"),p=i.data("ajax-onsuccess"),f=i.data("ajax-reload")||false;if(!r)r=i.text();var d=i.children(".fa");var u=c&&d.length>0;if(u){d.addClass("fa-spin")}else{App.loading("show")}i.trigger("processing");if(typeof a==="function")a=a.apply(this,arguments);$[n](t,a||{},function(e){i.data("processing",false);i.trigger("finished",arguments);if(u){d.removeClass("fa-spin")}else{App.loading("hide")}if(l)return l.apply(this,arguments);if(s){var t;if(o=="json"){if(e.Code!=1){return App.message({title:r,text:e.Info,type:"error",time:5e3,sticky:false})}t=e.Data}else{t=e}$(s).html(t);i.trigger("partial.loaded",arguments);$(s).trigger("partial.loaded",arguments);if(p)window.setTimeout(p,0);return}if(e.Code==1){if(p)window.setTimeout(p,2e3);if(f)window.setTimeout(function(){window.location.reload()},2e3)}if(o=="json"){return App.message({title:r,text:e.Info,type:e.Code==1?"success":"error",time:5e3,sticky:false})}App.message({title:r,text:e,time:5e3,sticky:false})},o).error(function(e,t,n){i.data("processing",false);i.trigger("finished",arguments);if(u){d.removeClass("fa-spin")}else{App.loading("hide")}App.message({title:r,text:e.responseText,type:"error",time:5e3,sticky:false})})})},attachPjax:function(e,t,a){if(!$.support.pjax)return;if(e==null)e="a";if(a==null)a=5e3;var n={onclick:null,onsend:null,oncomplete:null,ontimeout:null,onstart:null,onend:null};var r=$.extend({},n,t||{});$(document).on("click",e+"[data-pjax]",function(e){var t=$(this).data("pjax"),n=$(this).data("keepjs");var i=$(this).data("onclick");$.pjax.click(e,$(t),{timeout:a,keepjs:n});if(r.onclick)r.onclick(this);if(i&&typeof window[i]=="function")window[i](this)}).on("pjax:send",function(e,t,n){App.loading("show");if(r.onsend)r.onsend(e,t,n)}).on("pjax:complete",function(e,t,n,i){App.loading("hide");if(r.oncomplete)r.oncomplete(e,t,n,i)}).on("pjax:timeout",function(e,t,n){console.log("timeout");App.loading("hide");if(r.ontimeout)r.ontimeout(e,t,n)}).on("pjax:start",function(e,t,n){if(r.onstart)r.onstart(e,t,n)}).on("pjax:end",function(e,t,n){App.loading("hide");if(r.onend)r.onend(e,t,n);var i=n.container.attr("id");if(i){App.bottomFloat("#"+i+" .pagination");App.bottomFloat("#"+i+" .form-submit-group",0,true);$("#"+i+" .switch:not(.has-switch)").bootstrapSwitch()}if(n.type=="GET")$("#global-search-form").attr("action",n.url)})},loading:function(e,t){switch(e){case"show":NProgress.start();break;case"hide":NProgress.done();break;case"set":NProgress.set(t);break;case"inc":NProgress.inc(t);break}},insertAtCursor:function(e,t,n,i){if(typeof TextAreaEditor!="undefined"){TextAreaEditor.setSelectText(e,t,n,i);return}if(document.selection){e.focus();sel=document.selection.createRange();sel.text=t;sel.select()}else if(e.selectionStart||e.selectionStart=="0"){var a=e.selectionStart;var r=e.selectionEnd;var o=e.scrollTop;e.value=e.value.substring(0,a)+t+e.value.substring(r,e.value.length);if(o>0)e.scrollTop=o;e.focus();e.selectionStart=a+t.length;e.selectionEnd=a+t.length}else{e.value+=t;e.focus()}},wsURL:function(e){var t="ws:";if(window.location.protocol=="https:")t="wss:";var n=String(e).indexOf("//");if(n==-1){e=t+"//"+window.location.host+e}else{e=t+String(e).substring(n)}return e},websocket:function(t,e,n,i){if(!("WebSocket"in window))return;e=App.wsURL(e);var a=new WebSocket(e);a.onopen=function(e){console.log("Websocket Server is connected");if(n!=null&&$.isFunction(n))n.apply(this,arguments)};a.onclose=function(e){console.log("Websocket Server is disconnected");if(i!=null&&typeof i==="function")i.apply(this,arguments)};a.onmessage=function(e){if(t)t(e.data)};if(n!=null&&typeof n=="object"){a=$.extend({},a,n)}return a},titleBlinking:false,handleNotificationTag:function(){if(App.titleBlinking)return;App.titleBlinking=true;var t=document.title,n=App.t("【你有新消息】");var i=setInterval(function(){var e=document.title;if(document.hidden){if(e!==n){document.title=n}else{document.title=t}}else{App.titleBlinking=false;clearInterval(i);document.title=t}},500)},notification:null,sendNotification:function(e,t,n,i,a,r){if(!("Notification"in window)){if(r)r();return}if(Notification.permission==="denied"){if(r)r();return}var o=function(){window.focus();App.notification.close();App.notification=null;if("lastMessageId"in App)App.message("remove",App.lastMessageId);if(i){window.open(i)}},s=function(){if("notification"in App&&App.notification){try{App.notification.close()}catch{}}App.notification=new Notification(e,{body:t,icon:n,tag:"message",renotify:true,sound:a});App.notification.addEventListener("click",o)};if(Notification.permission==="granted"){s();return}if(r)r();Notification.requestPermission(function(e){if(e==="granted")s()})},messageNotify:function(t,n){if(!n.avatar)n.avatar=ASSETS_URL+"/images/user_50.png";App.sendNotification(App.t("%s说: ","「"+n.author+"」"),n.content,n.avatar,n.url,n.sound,function(){if("lastMessageId"in App)App.message("remove",App.lastMessageId);var e={title:App.text2html(t),text:"<strong>"+n.author+"</strong>"+(n.isAdmin?'<span class="badge badge-warning">'+App.t("管理员")+"</span>":"")+':<br /><a href="'+n.url+'" class="tx-white">'+n.content+"</a>",image:n.avatar,class_name:"dark",sticky:true,after_open:function(e){e.find("a").on("click",function(){if("notification"in App&&App.notification){try{App.notification.close();App.notification=null}catch{}}});if(n.sound&&e.find("audio").length>0){var t=e.find("audio")[0];if(t.duration!==NaN){t.currentTime=0;t.play()}}},after_close:function(){}};if(n.sound){e.text+='<audio style="visibility:hidden;position:absolute;bottom:0;" controls="controls" hidden="true" src="'+n.sound+'"></audio>'}App.lastMessageId=App.message(e);App.handleNotificationTag()})},notifyListen:function(t){if(t==null)t="/user/notice";var l={notify:0,element:0,modal:0},c={notify:20,element:50,modal:50},a=0,r=function(e){var t=$.parseJSON(e);if(typeof App.clientID["notify"]=="undefined"){App.clientID["notify"]=t.client_id}switch(t.mode){case"-":break;case"element":var n=$("#notify-element-"+t.type);if(n.length<1){var i="recv_notice_"+t.type;if(typeof window[i]!="undefined"){return window[i](t)}if(t.status>0){console.info(t.content)}else{console.error(t.content)}return}if(l[t.mode]>=c[t.mode]){n.find("li:first").remove()}if(t.title){var a="badge-danger";if(t.status>0)a="badge-success";e='<span class="badge '+a+'">'+App.text2html(t.title)+"</span> "+App.text2html(t.content)}else{e=App.text2html(t.content)}n.append("<li>"+e+"</li>");l[t.mode]++;break;case"modal":var n=$("#notify-modal-"+t.type);if(n.length<1){var i="recv_notice_"+t.type;if(typeof window[i]!="undefined"){return window[i](t)}if(t.status>0){console.info(t.content)}else{console.error(t.content)}return}if(t.title){var a="badge-danger";if(t.status>0)a="badge-success";e='<span class="badge '+a+'">'+App.text2html(t.title)+"</span> "+App.text2html(t.content)}else{e=App.text2html(t.content)}if(!n.data("shown")){l[t.mode]=0;var r=n.find(".modal-body"),o=r.children("ul.modal-body-ul");if(o.length<1){r.html('<ul class="modal-body-ul" id="notify-modal-'+t.type+'-container"><li>'+e+"</li></ul>")}else{o.html("<li>"+e+"</li>")}App.dialog().show({id:"notify-modal-"+t.type,title:App.t("身份验证"),type:"type-primary",message:html,nl2br:false,closeByBackdrop:false,onshown:function(e){n.data("shown",true)},onhidden:function(e){n.data("shown",false)}})}else{var s=$("#notify-modal-"+t.type+"-container");if(l[t.mode]>=c[t.mode]){s.find("li:first").remove()}s.append("<li>"+e+"</li>")}l[t.mode]++;break;case"notify":default:if(t.type=="message"){App.messageNotify(t.title,t.content);return}if("notify"!=t.mode)t.mode="notify";var n=$("#notice-message-container");if(n.length<1){App.message({title:App.i18n.SYS_INFO,text:'<ul id="notice-message-container" class="no-list-style" style="list-style:none;padding:0;max-height:500px;overflow-y:auto;overflow-x:hidden"></ul>',sticky:true});n=$("#notice-message-container")}if(l[t.mode]>=c[t.mode]){n.find("li:first").remove()}if(t.title){var a="badge-danger";if(t.status>0)a="badge-success";e='<span class="badge '+a+'">'+App.text2html(t.title)+"</span>"+App.text2html(t.content)}else{e=App.text2html(t.content)}n.append("<li>"+e+"</li>");l[t.mode]++;break}},o=function(e){var n=false;var i=App.websocket(function(e){r(e);if(!n)n=true},t,e,function(){if(!n)return;if(!(typeof CUSTOMER=="object"&&"ID"in CUSTOMER))return;var t=function(){window.setTimeout(function(){a++;try{if(i)i.close()}catch(e){}o(function(){a=0})},5e3*(a+1))};$.post(FRONTEND_URL+"/customer_info",{},function(e){if(e.Code!=1&&e.Code!=App.status.NotLoggedIn)return;t()}).error(function(){t()})});return i};o()},bottomFloat:function(e,r,o){if($(e).length<1)return;if(r==null)r=0;$(e).not("[disabled-fixed]").each(function(){var t=this;var e=$(t).height()+r;var n=$(t).offset().top+e;var i=$(t).outerWidth(),a=$(t).outerHeight();if(o||$(t).data("auto-width"))$(t).css("width",i);$(window).on("scroll",function(){var e=$(this).scrollTop()+$(window).height();if(e>=n){if($(t).hasClass("always-bottom")){$(t).removeClass("always-bottom");$(t).next(".fixed-placeholder").hide()}return}if(!$(t).hasClass("always-bottom")){$(t).addClass("always-bottom");if($(t).next(".fixed-placeholder").length>0){$(t).next(".fixed-placeholder").show()}else{$(t).after('<div style="width:'+i+"px;height:"+a+'px" class="fixed-placeholder"></div>')}}})});$(window).trigger("scroll")},getImgNaturalDimensions:function(e,t){if(e.naturalWidth){t({w:e.naturalWidth,h:e.naturalHeight});return}var n=new Image;n.onload=function(){t({w:n.width,h:n.height})};n.src=e.src},replaceURLParam:function(e,t,n){if(n==null)n=window.location.href;t=encodeURIComponent(t);var i=String(n).indexOf("?");if(i<0)return n+"?"+e+"="+t;var a=n.substring(i),r=new RegExp("([\\?&]"+e+"=)[^&]*(&|$)");if(!r.test(a))return n+"&"+e+"="+t;n=n.substring(0,i);a=a.replace(r,"$1"+t+"$2");return n+a},switchLang:function(e){window.location=App.replaceURLParam("lang",e)},tableSorting:function(e){e=e==null?"":e+" ";$(e+'[sort-current!=""]').each(function(){var e=String($(this).attr("sort-current"));var t=e.substring(0,1)=="-";if(t)e=e.substring(1);var n=$(this).find('[sort="'+e+'"]');var i,a,r;if(n.length<1&&e){n=$(this).find('[sort="-'+e+'"]')}if(!t){i="fa-arrow-up";r="up";a="fa-arrow-down"}else{i="fa-arrow-down";r="down";a="fa-arrow-up"}if(n.length>0){var o=n.children(".fa");if(o.length<1){n.append('<i class="fa '+i+'"></i>')}else{o.removeClass(a).addClass(i)}n.addClass("sort-active sort-"+r);n.siblings(".sort-active").removeClass("sort-active").removeClass("sort-up").removeClass("sort-down")}});$(e+"[sort-current] [sort]").css("cursor","pointer").on("click",function(e){var t=$(this).parents("[sort-current]");var n=t.attr("sort-current");var i=t.attr("sort-url")||window.location.href;var a=t.attr("sort-trigger");var r=$(this).attr("sort");if(n&&(n==r||n=="-"+r)){var o=/^\-/;n=o.test(n)?n.replace(o,""):"-"+n}else{n=r}i=App.replaceURLParam("sort",n,i);if(a){t.trigger("sort")}else{var s=t.attr("sort-setto");if(s){$(s).load(i)}else{window.location=i}}})},formatBytes:function(e,t){if(t==null)t=2;var n=["YB","ZB","EB","PB","TB","GB","MB","KB","B"];var i=n.length;for(i--;i>0&&e>1024;i--){e/=1024}return e.toFixed(t)+n[i]},progressMonitor:function(t,n){NProgress.start();var i=window.setInterval(function(){var e=t()/n;if(e>=1){NProgress.set(1);window.clearInterval(i)}else{NProgress.set(e)}},50)},float:function(e,t,n,i,a){if(!t)t="ajax";if(!n)n=t=="remind"?"rel":"src";if(!i)i="5-7";else{switch(i){case"bottom":i="5-7";break;case"right":i="8-6";break;case"top":i="7-5";break;case"left":i="6-8";break;case"left-bottom":i="2-4";break;case"right-bottom":i="1-3";break;case"left-top":i="3-1";break;case"right-top":i="4-2";break}}var r={targetMode:t,targetAttr:n,position:i};$(e).powerFloat($.extend(r,a||{}))},uploadPreviewer:function(e,t,n){if($(e).parent(".file-preview-shadow").length<1){var i={buttonText:'<i class="fa fa-cloud-upload"></i> '+App.i18n.BUTTON_UPLOAD,previewTableContainer:"#previewTableContainer",url:"",previewTableShow:false,uploadProgress:function(e){var t=e*100;if(t>100){$.LoadingOverlay("hide");return}$.LoadingOverlay("progress",t)}};var a=$.extend({},i,t||{});var r=$(e).uploadPreviewer(a);$(e).data("uploadPreviewer",r);$(e).on("file-preview:changed",function(e){var t={image:ASSETS_URL+"/images/nging-gear.png",text:App.i18n.UPLOADING};if(a.uploadProgress){t.progress=true;t.image=""}$.LoadingOverlay("show",t);r.submit(function(e){$.LoadingOverlay("hide");if(e.Code==1){App.message({text:App.i18n.UPLOAD_SUCCEED,type:"success"})}else{App.message({text:e.Info,type:"error"})}if(n!=null)n.call(this,e)})})}},showRequriedInputStar:function(){$("form:not([required-redstar])").each(function(){$(this).find("[required]").each(function(){var e=$(this).attr("id");if($("label[for="+e+"]").length>0){$("label[for="+e+"]").addClass("required");return}var t=$(this).parent(".input-group");if(t.length>0){t.addClass("required");return}t=$(this).parent('div[class*="col-"]');if(t.length>0){if(t.prev(".control-label").length>0){t.prev(".control-label").addClass("required");return}if(t.prev(".col-form-label").length>0){t.prev(".col-form-label").addClass("required");return}}var n=$(this).closest(".form-group");if(n.length<1)return;var i=n.children(".control-label:not(.required),.col-form-label:not(.required)");if(i.length<1)return;i.addClass("required")});$(this).attr("required-redstar","1")})},pushState:function(e,t,n){if(!window.history||!window.history.pushState)return;window.history.pushState(e,t,n)},replaceState:function(e,t,n){if(!window.history||!window.history.replaceState)return;window.history.replaceState(e,t,n)},formatJSON:function(e){e=$.trim(e);var t=e.substring(0,1);if(t=="["||t=="{"){var n=JSON.parse(e);e=JSON.stringify(n,null,"\t");return e}return""},formatJSONFromInnerHTML:function(e){if(e.data("jsonformatted"))return;e.data("jsonformatted",true);var t=App.formatJSON(e.html());if(t!="")e.html(t)},captchaUpdate:function($form,resp){if(!App.captchaHasError(resp.Code)||!resp.Data||typeof resp.Data.captchaType==="undefined")return;if(false==$form instanceof jQuery)$form=$($form);switch(resp.Data.captchaType){case"api":if(resp.Data.jsURL&&$('script[src="'+resp.Data.jsURL+'"]').length<1){$("body").append('<script src="'+resp.Data.jsURL+'" type="text/javascript"><\/script>');if(resp.Data.jsInit){eval(resp.Data.jsInit)}return}if(resp.Data.jsCallback){eval("("+resp.Data.jsCallback+")();")}break;default:var idElem=$form.find("input#"+resp.Data.captchaIdent);idElem.val(resp.Data.captchaID);idElem.siblings("img").attr("src",resp.Data.captchaURL);if(resp.Data.captchaName)$form.find('input[name="'+resp.Data.captchaName+'"]').focus()}},captchaHasError:function(e){return e>=-11&&e<=-9},fixedFooter:function(e,i){var t=$(e);if(t.length<1)return;var a=t.css("marginTop");if(i==null)i=$(".pos-fixed-top:first").height();var n=function(e){var t=e.position().top+e.height()+i;var n=$(window).height()-t;if(n>0)e.css("margin-top",n+"px");else if(n<0)e.css("margin-top",a)};n(t);$(window).on("resize",function(){n(t)})}};return window.App});