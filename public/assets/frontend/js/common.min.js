function showModal(t,a){var e=$("#error-dialog").data("old-class")||"danger";var n=$("#error-dialog").find('#error-button[data-dismiss="modal"]');var o=n.attr("class");var i=String(o).match(/btn-([^ ]+)/);var r,s=$("#error-dialog").data("old-icon")||"ion-ios-close-outline";$("#error-dialog").data("old-class",i[1]);if(a==null)a="error";switch(a){case"error":a="danger";r="ion-ios-close-outline";break;case"success":r="ion-ios-checkmark-outline";break;default:a="info";r="ion-info";break}$("#error-dialog").data("old-icon",r);if(e){n.removeClass("btn-"+e).addClass("btn-"+a);$("#error-dialog").find(".tx-"+e).removeClass("tx-"+e).addClass("tx-"+a);$("#error-dialog").find("."+s).removeClass(s).addClass(r)}$("#error-dialog").find("#error-message").text(t);$("#error-dialog").modal("show")}function hideModal(){$("#error-dialog").modal("hide")}function signIn(e,n){if(n==null)n=window.location.href;var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/sign_in";var o={url:a,type:"POST",data:t,dataType:"json",success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&t.Data&&typeof t.Data.captchaName!="undefined"&&t.Data.captchaName&&$(e).find('input[name="'+t.Data.captchaName+'"]').length<1){return captchaDialog(t,o)}showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments);window.setTimeout(function(){if(!n||n.indexOf("/sign_")>=0)n="/index";window.location.href=n},2e3)},error:function(t){}};$.ajax(o)}function signUp(e,n){if(n==null)n=window.location.href;var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/sign_up";var o={url:a,type:"POST",data:t,dataType:"json",success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&t.Data&&typeof t.Data.captchaName!="undefined"&&t.Data.captchaName&&$(e).find('input[name="'+t.Data.captchaName+'"]').length<1){return captchaDialog(t,o)}showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments);window.setTimeout(function(){if(!n||n.indexOf("/sign_")>=0)n="/index";window.location.href=n},2e3)},error:function(t){}};$.ajax(o)}function keyEnter(t,a){if($(t).length<1)return;$(t).on("keyup",function(t){if(t.keyCode==13)a.apply(this)})}function showMsg(t,a){App.message(t,a)}function closeMsg(){$.gritter.removeAll()}function renewCaptcha(t,a){if(t==null)return;App.captchaUpdate(t,a)}function captchaDialog(t,a){if(typeof t.Data=="undefined"||typeof t.Data.captchaType=="undefined"){showMsg({text:t.Info,type:"error"});return false}switch(t.Data.captchaType){case"api":return apiCaptchaDialog(t,a);default:return defaultCaptchaDialog(t,a)}}function apiCaptchaDialog(resp,ajaxOptions){if(typeof resp.Data=="undefined"||typeof resp.Data.provider=="undefined"){showMsg({text:resp.Info,type:"error"});return false}if(typeof ajaxOptions.postByCaptchaDialog!="undefined"&&ajaxOptions.postByCaptchaDialog){showMsg({text:resp.Info,type:"error"})}var jsURL=resp.Data.jsURL,captchaName=resp.Data.captchaName,captchaIdent=resp.Data.captchaIdent,htmlCode=resp.Data.html,jsInit=resp.Data.jsInit;if(jsURL&&$('script[src="'+jsURL+'"]').length<1){$("body").append('<script src="'+jsURL+'" type="text/javascript"><\/script>')}var formHTML='<form method="post" id="dialog-retry-captcha">        <div class="form-group mg-b-0" style="position:relative">            <div class="captcha-loading text-center" id="'+resp.Data.locationID+'-loading" style="position:relative"><i class="fa fa-spinner fa-spin"></i> '+App.t("验证加载中，请稍候...")+'</div>            <div style="position:relative;z-index:2;margin-top:-20px;min-height:20px">'+htmlCode+"</div>        </div>\x3c!-- form-group --\x3e    </form>";var done=function(t){var a=$("#dialog-retry-captcha");var e=a.find('[name="'+captchaName+'"]').val();var n=a.find('[name="'+captchaIdent+'"]').val();postCaptchaDialogData(resp,ajaxOptions,e,n,captchaName,captchaIdent);t.close()};App.dialog().show({title:App.t("人机验证"),type:"type-primary",size:"size-small",message:formHTML,nl2br:false,closeByBackdrop:false,onshown:function(d){if(jsInit)eval(jsInit);$("#dialog-retry-captcha").on("submit",function(t){t.preventDefault();d.getButton("captchaDialogBtnSubmit").trigger("click")})},buttons:[{id:"captchaDialogBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:done},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]});return true}function defaultCaptchaDialog(n,o){if(typeof n.Data=="undefined"||typeof n.Data.captchaURL=="undefined"){showMsg({text:n.Info,type:"error"});return false}if(typeof o.postByCaptchaDialog!="undefined"&&o.postByCaptchaDialog){showMsg({text:n.Info,type:"error"})}var i=n.Data.captchaName,t=n.Data.captchaURL;var a=n.Data.captchaID,r=n.Data.captchaIdent;var e='<form method="post" id="dialog-retry-captcha">        <div class="form-group mg-b-0">            <div class="input-group">              <input type="text" placeholder="'+App.t("图像验证码")+'" value="" name="'+i+'" required="required" data-toggle="tooltip" title="'+App.t("请输入验证码")+'" class="form-control" id="dialog-captcha-code">              <span class="input-group-addon pd-0"><img id="captchaImage" src="'+t+"\" alt=\"Captcha image\" onclick=\"this.src=this.src.split('?')[0]+'?reload='+Math.random();\" onerror=\"if(this.src.indexOf('?reload=')!=-1 && confirm('"+App.t("页面验证码已经失效，必须重新请求当前页面。确定要刷新本页面吗？")+'\')) window.location.reload();" style="cursor:pointer"><input type="hidden" id="dialog-captcha-id" name="'+r+'" value="'+a+'"></span>            </div>            <small id="dialog-captcha-code-help" class="form-text text-muted">'+App.t("请输入图片上显示的验证码")+"</small>        </div>\x3c!-- form-group --\x3e    </form>";App.dialog().show({title:App.t("操作验证"),type:"type-primary",size:"size-small",message:e,nl2br:false,closeByBackdrop:false,onshown:function(a){var t=$("#dialog-captcha-code");t.focus();t.select();$("#dialog-retry-captcha").on("submit",function(t){t.preventDefault();a.getButton("captchaDialogBtnSubmit").trigger("click")})},buttons:[{id:"captchaDialogBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(t){var a=$("#dialog-captcha-code").val();var e=$("#dialog-captcha-id").val();postCaptchaDialogData(n,o,a,e,i,r);t.close()}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]});return true}function postCaptchaDialogData(t,a,e,n,o,i){var r="ajaxFormObject"in a&&a.ajaxFormObject;if(!r||t.Zone&&$(a.ajaxFormObject).find('[name="'+t.Zone+'"]').length<1){if(!a.data)a.data={};switch(typeof a.data){case"string":a.data+="&"+o+"="+encodeURIComponent(e)+"&"+i+"="+encodeURIComponent(n);break;default:if($.isArray(a.data)){var s=false,l=false;var c={name:o,value:e};var p={name:i,value:n};for(var d=0;d<a.data.length;d++){if(a.data[d].name==o){a.data[d]=c;s=true}if(a.data[d].name==i){a.data[d]=p;l=true}if(l&&s)break}if(!l)a.data.push(p);if(!s)a.data.push(c);break}a.data[o]=e;a.data[i]=n}}a.postByCaptchaDialog=true;if(r){var f=$(a.ajaxFormObject);var u=f.find('[name="'+o+'"]');if(u.length>0){u.val(e);f.find('[name="'+i+'"]').val(n)}f.trigger("submit")}else{$.ajax(a)}}function signInDialog(a){if($("#modal-sign-in").length>0)return $("#modal-sign-in").modal("show");$.get("/sign_in",{modal:1,next:window.location.href},function(t){$("body").append(t);if(a!=null&&$.isFunction(a)){$("#modal-sign-in-form").data("callback",function(){$("#modal-sign-in").modal("hide");return a.apply(this,arguments)})}$("#modal-sign-in").modal("show");$("#modal-sign-in").on("shown.bs.modal",function(){$("#modal-sign-in-form").find('input[name="name"]').focus()})},"html")}function inputVerifyCode(t,i,r,s){if(r==null)r=window.location.href;var a='<form method="post" id="dialog-vcode-form">  <div class="form-group mg-b-0">    <input type="text" placeholder="'+App.t("请输入%s验证码",t)+'" value="" name="code" required="required" data-toggle="tooltip" title="'+App.t("请输入%s验证码",t)+'" class="form-control" id="dialog-input-vcode">    <small id="dialog-input-vcode-help" class="form-text text-muted">'+App.t("请输入您接收到的%s验证码",t)+"</small>  </div></form>";App.dialog().show({title:App.t("请输入%s验证码",t),type:"type-primary",size:"size-small",message:a,nl2br:false,closeByBackdrop:false,onshown:function(a){var t=$("#dialog-input-vcode");t.focus();t.select();$("#dialog-vcode-form").on("submit",function(t){t.preventDefault();a.getButton("inputVerifyCodeBtnSubmit").trigger("click")})},buttons:[{id:"inputVerifyCodeBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(a){var t=$("#dialog-input-vcode").val();var e;var n=function(){e.push({name:"vcode",value:t});e.push({name:"verify",value:1})};switch(typeof i){case"object":if(!$.isArray(i)){e={};for(var o in i){e[o]=i[o]}e["vcode"]=t;e["verify"]=1;break}e=[];for(var o=0;o<i.length;o++){e.push(i[o])}n();break;case"string":e=$(i).serializeArray();n();break;default:e=[];n();break}$.post(r,e,function(t){if(t.Code==1){a.close();App.message({text:t.Info,type:"success"});if(s!=null)return s.apply(this,arguments);window.setTimeout(function(){window.location.reload()},2e3);return}App.message({text:t.Info,type:"error"})},"json")}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})}function authDialog(l,c,p,d){if(d==null)d=window.location.href;$.get(BASE_URL+"/user/profile/_authentication",{type:l},function(t){var a=t.Data.html;var e=App.t("验证密码"),n="check";var s=t.Data.waitingSeconds;switch(t.Data.type){case"email":e=App.t("发送邮件");n="paper-plane";break;case"mobile":e=App.t("发送短信");n="paper-plane";break}App.dialog().show({id:"authentication-dialog",title:App.t("身份验证"),type:"type-primary",message:a,nl2br:false,closeByBackdrop:false,onshown:function(t){var a=$("#authentication-form");var e=a.find("input:not(readonly):first");e.focus();e.select();a.prev("ul.nav").find("a.nav-link").on("click",function(){authDialog($(this).data("type"),$(this).data("object-name"),p,d);t.close()})},buttons:[{id:"authentication-btn-submit",label:e,icon:"fa fa-"+n,cssClass:"btn-primary mg-r-10",action:function(a){var e=this;var n=$(p).serializeArray();var t=$("#authentication-form").serializeArray();for(var o=0;o<t.length;o++)n.push(t[o]);var i=d.indexOf("?")==-1?"?":"&";var r=l=="password"?"verify":"send";if(r=="send")btnDisabled(e,'<i class="fa fa-spinner fa-spin"></i> '+App.t("发送中，请稍候..."));$.post(d+i+"step="+r,n,function(t){if(r=="send")btnEnabled(e);renewCaptcha("#authentication-form",t);if(t.Code!=1)return App.message({text:t.Info,type:"error"});if(r=="send")waiting(e,s);if(t.Data.nextStep=="verify"){App.message({text:t.Info+","+App.t("请输入您收到的验证码"),type:"success"});return inputVerifyCode(c,n,d+i+"step=verify",function(){a.close()})}App.message({text:t.Info,type:"success"});a.close()},"json")}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})},"json")}function commentList(t,a,e,n){if(t==null)t=1;if(a==null)a="#comment-list-container";if(n==null)n=false;var o=$(a);if(!o||o.length<1)return;if(e==null)e=o.data("url");if(!e)return;loadCommentList(o,e,{page:t,html:1,_pjax:"true"},n,$("#headPanel").height()+90)}function loadCommentList(a,t,e,n,o){$.get(t,e||{},function(t){if(t.Code!=1)return showMsg(t.Info);a.html(t.Data.html);bindCommentList(a,n,o);if(!n&&t.Data.pagination){$(".comment-count-num").text(t.Data.pagination.rows)}},"json")}function bindCommentList(a,e,n){if(n===null)n=0;if(e===null)e=false;var o=a.data("replace-state")||false;a.find("[data-reply-id]").on("click",function(){var t=$(this).data("reply-id");var a=$("#reply-list-box-"+t);commentList(1,a[0],a.data("url"),true)});attachContype(a);a.find("[data-comment-like-id]").on("click",function(){var t=$(this).data("comment-like-id"),e=$(this);$.post(BASE_URL+"/article/comment_like",{id:t},function(t){if(t.Code<1){App.message({text:t.Info,type:"error"});return}e.removeClass("tx-gray-light").addClass("tx-success");var a=e.find(".comment-likes");if(a.length>0){a.text(a.text()*1+1)}},"json")});a.find('.pagination a[data-pjax="true"]').on("click",function(t){t.preventDefault();if(o)App.replaceState(null,"",$(this).attr("href"));loadCommentList(a,$(this).attr("href"),null,e,n);$("html, body").animate({scrollTop:a.offset().top-n},0)})}function initCommentForm(o){if(o==null)o="#comment-post-form";if($(o).data("attached"))return;$(o).data("attached",true);$(o).find("[required]").on("keyup blur",function(){var t=$.trim($(this).val());if(t==""){$(this).addClass("form-control-warning").parent().addClass("has-warning")}else{$(this).removeClass("form-control-warning").parent().removeClass("has-warning")}});var a=function(){var t=$(o).find(".form-control-warning[required]");if(t.length>0){t.focus();showMsg(t.attr("placeholder"));return}var a=$(o).attr("action");var e=true;$(o).find("[required]").each(function(){var t=$.trim($(this).val());if(t==""){if(e){$(this).focus();showMsg($(this).attr("placeholder"))}e=false;$(this).addClass("form-control-warning").parent().addClass("has-warning")}});if(!e)return;$.post(a,$(o).serializeArray(),function(t){renewCaptcha($(o),t);showMsg(t.Info);if(t.Code>0){if($(".show-after-comment.mission-uncompleted").length>0){window.setTimeout(function(){window.location.reload()},2e3);return}if(/^modal-/.test($(o).attr("id"))){$(o).parents(".modal").modal("hide")}var a=$(o).find("#reply-id");var e=a.data("root-id")||0;if(e&&$("#reply-list-box-"+e).length>0){var n=$("#reply-list-box-"+e);commentList(1,n[0],n.data("url"),true)}else{commentList(1)}$(o).find("[name=content]").val("");$(o).find("[name=code]").val("")}},"json")};$(o).on("submit",function(t){t.preventDefault();a.apply(this,arguments)});$(o).find("[data-form]:not(:submit)").on("click",a)}function initPageAllCommentForm(){initCommentForm();initCommentForm("#modal-comment-post-form");$("#modal-comment-form").on("show.bs.modal",function(t){var a=$(t.relatedTarget);var e=a.data("comment-id")||"0";var n=a.data("root-id")||"0";var o=$(this);var i=o.find("#reply-id");i.val(e);i.data("root-id",n);var r=o.find("#reply-comment-blockquote");if(e>0){r.show();r.find("#reply-comment-content").html($(a.data("comment-content")).html());r.find("#reply-comment-author").html(a.data("comment-author"))}else{r.hide();r.find("#reply-comment-content").html("");r.find("#reply-comment-author").html("")}})}function follow(a){var t=$(a).data("following-uid");var e={uid:t};var n=$(a).hasClass("btn-outline-primary");if(!n)e["unfollow"]=1;$.post(BASE_URL+"/user/profile/following",e,function(t){if(t.Code<1){showMsg({text:t.Info,type:"error"});if(t.Code==App.status.NotLoggedIn)window.location.href=t.URL+"?next=".encodeURLComponent(window.location.href);return}showMsg({text:t.Info,type:"success"});if(n){$(a).removeClass("btn-outline-primary").addClass("btn-outline-gray-lighter active");$(a).text($(a).data("i18n-followed"))}else{$(a).removeClass("btn-outline-danger").removeClass("btn-outline-gray-lighter active").addClass("btn-outline-primary");$(a).text($(a).data("i18n-following"))}},"json")}function setFollowStatus(a){var t=$(a).data("following-uid");if(t==CUSTOMER.ID){return $(a).replaceWith("<small>"+App.t("这是我")+"</small>")}$.post(BASE_URL+"/user/profile/is_followed",{uid:t},function(t){if(t.Code>0){$(a).removeClass("btn-outline-primary").addClass("btn-outline-danger");$(a).text($(a).data("i18n-unfollow"))}},"json")}function btnDisabled(t,a){var e=t.data("original-innerhtml");if(!e){e=t.html();t.data("original-innerhtml",e)}t.prop("disabled",true);t.html(a)}function btnEnabled(t){var a=t.data("original-innerhtml");t.html(a);t.prop("disabled",false)}function waiting(t,a){if(t.prop("disabled"))return;if(a==null)a=60;var e="timedown-"+String(Math.random()).replace(".","");btnDisabled(t,'<i class="fa fa-spinner fa-spin"></i> <span id="'+e+'">'+a+App.t("秒后可重试")+"</span>");var n=$("#"+e);var o=a;var i=window.setInterval(function(){o--;if(o<=0){window.clearInterval(i);btnEnabled(t);return}n.text(o+App.t("秒后可重试"))},1e3)}function countWords(t,a){if(a==null){var e=$(t).attr("id"),n=$(t).attr("name");if($("#"+e+"WordsCount").length>0)a="#"+e+"WordsCount";else if($("#"+n+"WordsCount").length>0)a="#"+n+"WordsCount";else throw"Variable countElem is undefined"}$(a).text(Number($(t).attr("maxlength"))-$(t).val().length)}function ajaxForm(a,e,n){var o={ajaxFormObject:a,type:String($(a).attr("method")).toLowerCase()=="post"?"post":"get",dataType:"json",data:{},url:$(a).attr("action"),success:function(t){onAjaxRespond(a,t,o,e,n)}};$(a).ajaxForm(o)}function onAjaxRespond(t,a,e,n,o){if(a.Code==1){renewCaptcha(t,a);if(n!=null&&$.isFunction(n))n(a);return showMsg({text:a.Info,type:"success"})}if(a.Code==App.status.NotLoggedIn){return signInDialog(function(){})}if(App.captchaHasError(a.Code))return captchaDialog(a,e);showMsg({text:a.Info,type:"error"});renewCaptcha(t,a);if(o!=null&&$.isFunction(o))o(a)}function hasScroll(t,a){var e=!a||a==="vertical"?"scrollTop":"scrollLeft";var n=!!t[e];if(!n){t[e]=1;n=!!t[e];t[e]=0}return n}function complaint(e){var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/complaint";var n={url:a,type:"POST",data:t,dataType:"json",success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&$(e).find('input[name="'+t.Zone+'"]').length<1){return captchaDialog(t,n)}showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments)},error:function(t){}};$.ajax(n)}function complaintModal(t,n){var a=$(t).data("complaint-url");if(!a)return;var e=$(t).data("complaint-name");var o=$(t).data("complaint-types")||[];var i="";for(var r=0;r<o.length;r++){var s=o[r],l=r==0?' checked="checked"':"";i+='<label class="custom-control custom-radio">        <input type="radio" class="custom-control-input" value="'+s.K+'" name="type"'+l+'>        <span class="custom-control-indicator"></span>        <span class="custom-control-description">'+s.V+"</span>    </label>"}var c='<form method="post" id="dialog-complaint-form" action="'+a+'">  <div class="form-group mg-b-0">'+i+'</div>  <div class="form-group mg-b-0">    <textarea placeholder="'+App.t("投诉内容")+'" value="" name="content" required="required" data-toggle="tooltip" title="'+App.t("请输入投诉内容")+'" class="form-control" id="dialog-input-complaint-content"></textarea>    <small id="dialog-input-complaint-content-help" class="form-text text-muted">'+App.t("请输入投诉内容")+"</small>  </div></form>";App.dialog().show({title:App.t("投诉《%s》",e),type:"type-primary",size:"size-middle",message:c,nl2br:false,closeByBackdrop:true,onshown:function(a){var t=$("#dialog-input-complaint-content");t.focus();t.select();$("#dialog-complaint-form").on("submit",function(t){t.preventDefault();a.getButton("complaintFormBtn").trigger("click")})},buttons:[{id:"complaintFormBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(a){var t=$("#dialog-input-complaint-content");var e=$.trim(t.val());if(e==""){showMsg({text:App.t("请输入投诉内容"),type:"warning"});return}t.val(e);$("#dialog-complaint-form").data("callback",function(t){if(t.Code==1){a.close();if(n!=null)return n.apply(this,arguments)}});complaint("#dialog-complaint-form")}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})}function forgotModal(t,l){var c=$(t).data("submit-url");var a=$(t).data("form-tmpl");var p=$(t).data("name-sync");if(!c)return;var e="dialog-recv-recover-code-form",d="#"+e;var n='<form method="post" id="'+e+'" action="'+c+'">';n+=$(a).html();n+="</form>";App.dialog().show({title:App.t("找回密码：获取验证码"),type:"type-primary",size:"size-middle",message:n,nl2br:false,closeByBackdrop:true,onshown:function(a){var t=$(d);if(p){var e=$(p).val();if(e)t.find('input[name="name"]').val(e)}var n=t.find("input[type=text]:first");n.focus();n.select();t.on("submit",function(t){t.preventDefault();a.getButton("recvRecoverCodeFormBtn").trigger("click")});t.find("select[name=type]").off().on("change",function(){switch($(this).val()){case"mobile":t.find("input[name=account]").attr("placeholder",App.t("手机号码"));break;default:t.find("input[name=account]").attr("placeholder",App.t("E-mail地址"));break}})},buttons:[{id:"recvRecoverCodeFormBtn",label:App.t("发送"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(e){var t=["name","account"];for(var a=0;a<t.length;a++){var n=t[a];var o=$(d).find('input[name="'+n+'"]');var i=$.trim(o.val());if(i==""){var r="";switch(n){case"name":r=App.t("请输入用户名");break;case"account":r=App.t("请输入%s",o.attr("placeholder"));break;default:r=n}showMsg({text:r,type:"warning"});o.focus();return}o.val(i)}var s={url:c,type:"POST",data:$(d).serializeArray(),dataType:"json",success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&$(d).find('input[name="'+t.Zone+'"]').length<1){return captchaDialog(t,s)}showMsg({text:t.Info,type:"error"});return renewCaptcha(d,t)}showMsg({text:t.Info,type:"success"});if(p){var a=$(d);$(p).val(a.find('input[name="name"]').val())}if(l!=null){l.apply($(d),arguments)}e.close()},error:function(t){}};$.ajax(s)}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})}function openForgotModal(t){forgotModal(t,function(t){$("#recvType").val(this.find("select[name=type]").val());$("#recvAccount").val(this.find("input[name=account]").val())})}function resetPassword(e,n){var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/forgot";var o={url:a,type:"POST",data:t,dataType:"json",success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&$(e).find('input[name="'+t.Zone+'"]').length<1){return captchaDialog(t,o)}showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments);window.setTimeout(function(){if(!n||n.indexOf("/forgot")>=0)n="/index";window.location.href=n},2e3)},error:function(t){}};$.ajax(o)}function getColorByRandom(t){var a=Math.floor(Math.random()*t.length);var e=t[a];t.splice(a,1);return e}function tagsRandomColor(t,a){if(!t)t=".tags-container > .tag-item";if(a==null)a=0;var e=["orange","coral","darkorange","darksalmon","hotpink","#9dc6eb","#f8c471","#b9a3ef","#fdb1ca","#9dc6eb","#f8c471","#b9a3ef","#fdb1ca"];var n=$(t);var o=n.length;for(var i=a;i<o;i++){var r=getColorByRandom(e);n.eq(i).css("background-color",r)}}function backLastPage(t){if(t==null){window.location.href=document.referrer;return}window.history.go(t)}function setNavActive(){var t=$("#navbarMain .active");if(t.length<1)return;while(true){var a=t.attr("class");if(t.hasClass("dropdown-item")){t=t.closest(".dropdown-menu").prev("a:not(.active)")}else{t=t.closest("ul").prev("a:not(.active)")}if(t.length<1)return;if(t.hasClass("nav-link"))return t.addClass("active");t.attr("class",a)}}function attachContype(t){if(typeof App.editor==="undefined")return;var a=t?$(t):$(document);a.find("[data-contype]:not([contype-attached])").each(function(){$(this).attr("contype-attached","1");var t=$(this).data("contype");switch(t){case"markdown":App.editor.markdownToHTML(this);break;case"html":var a=$(this).find("pre[class^=language-]");if(a.length>0)App.editor.codeHighlight(a);break}})}function commonInit(t,a){if(window.errorMSG)a.message({title:a.i18n.SYS_INFO,text:a.ifTextNl2br(window.errorMSG),class_name:"danger"});if(window.successMSG)a.message({title:a.i18n.SYS_INFO,text:a.ifTextNl2br(window.successMSG),class_name:"success"});t(function(){t('[data-toggle="tooltip"]:not(data-original-title)').tooltip();t("[data-following-uid]").each(function(){setFollowStatus(this)});t("textarea[count-words]").on("keyup",function(){countWords(this,t(this).attr("count-words"))}).trigger("keyup");t("form[ajax-submit]").each(function(){ajaxForm(this)});a.fixedFooter(".footer-fix");a.bottomFloat(".auto-bottom-float",0,true);a.showRequriedInputStar();setNavActive();attachContype()})}if(typeof jQuery!=="undefined"&&typeof App!=="undefined"){commonInit(jQuery,App)}