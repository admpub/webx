function showModal(t,a){var e=$("#error-dialog").data("old-class")||"danger";var n=$("#error-dialog").find('#error-button[data-dismiss="modal"]');var o=n.attr("class");var i=String(o).match(/btn-([^ ]+)/);var r,s=$("#error-dialog").data("old-icon")||"ion-ios-close-outline";$("#error-dialog").data("old-class",i[1]);if(a==null)a="error";switch(a){case"error":a="danger";r="ion-ios-close-outline";break;case"success":r="ion-ios-checkmark-outline";break;default:a="info";r="ion-info";break}$("#error-dialog").data("old-icon",r);if(e){n.removeClass("btn-"+e).addClass("btn-"+a);$("#error-dialog").find(".tx-"+e).removeClass("tx-"+e).addClass("tx-"+a);$("#error-dialog").find("."+s).removeClass(s).addClass(r)}$("#error-dialog").find("#error-message").text(t);$("#error-dialog").modal("show")}function hideModal(){$("#error-dialog").modal("hide")}function signIn(e,n){var o=checkSubmitBtnWithCloser(e);if(o.submited)return;if(n==null)n=window.location.href;var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/sign_in";var i={url:a,type:"POST",data:t,dataType:"json",close:o.close,success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&t.Data&&typeof t.Data.captchaName!="undefined"&&t.Data.captchaName&&$(e).find('input[name="'+t.Data.captchaName+'"]').length<1){return captchaDialog(t,i)}o.close();showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}o.close();showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments);window.setTimeout(function(){if(!n||n.indexOf("/sign_")>=0)n="/index";window.location.href=n},2e3)},error:function(t){o.close()}};$.ajax(i)}function signUp(e,n){var o=checkSubmitBtnWithCloser(e);if(o.submited)return;if(n==null)n=window.location.href;var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/sign_up";var i={url:a,type:"POST",data:t,dataType:"json",close:o.close,success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&t.Data&&typeof t.Data.captchaName!="undefined"&&t.Data.captchaName&&$(e).find('input[name="'+t.Data.captchaName+'"]').length<1){return captchaDialog(t,i)}o.close();showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}o.close();showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments);window.setTimeout(function(){if(!n||n.indexOf("/sign_")>=0)n="/index";window.location.href=n},2e3)},error:function(t){o.close()}};$.ajax(i)}function keyEnter(t,a){if($(t).length<1)return;$(t).on("keyup",function(t){if(t.keyCode==13)a.apply(this)})}function showMsg(t,a){App.message(t,a)}function closeMsg(){$.gritter.removeAll()}function renewCaptcha(t,a){if(t==null)return;App.captchaUpdate(t,a)}function signInByQRCode(){$.post(FRONTEND_URL+"/qrcode/sign_in",{},function(t){if(t.Code!=1)return App.message({text:t.Info,type:"error"});showQRCodeSignInDialog(t.Data.qrcode,t.Data.expires)},"json").error(function(){return App.message({text:App.t("网络错误"),type:"error"})})}function showQRCodeSignInDialog(t,a){var e=null;App.dialog().show({title:App.t("扫码登录"),message:'<img src="'+FRONTEND_URL+"/qrcode?data="+t+'" /><br /><div style="text-align:center">'+App.t("过期时间: %s",a)+"</div>",nl2br:false,closeByBackdrop:false,onshow:function(t){t.$modalDialog.css({"max-width":"330px"});t.$modalDialog.find("img").off("click").on("click",function(){var a=$(this);$.post(FRONTEND_URL+"/qrcode/sign_in",{},function(t){if(t.Code!=1)return App.message({text:t.Info,type:"error"});a.attr("src",FRONTEND_URL+"/qrcode?data="+t.Data.qrcode);a.siblings("div").text(App.t("过期时间: %s",t.Data.expires))},"json").error(function(){return App.message({text:App.t("网络错误"),type:"error"})})})},onshown:function(a){e=setInterval(function(){$.post(FRONTEND_URL+"/customer_info",{},function(t){if(t.Code==App.status.NotLoggedIn)return;clearInterval(e);if(t.Code==1){App.message({text:App.t("登录成功")});setTimeout(function(){a.close();window.location.reload()},2e3)}},"json").error(function(){clearInterval(e)})},2e3)},onhide:function(t){if(e)clearInterval(e)}})}function captchaDialog(t,a){if(typeof t.Data=="undefined"||typeof t.Data.captchaType=="undefined"){showMsg({text:t.Info,type:"error"});closeLoadingFunction(a);return false}switch(t.Data.captchaType){case"api":return apiCaptchaDialog(t,a);case"go":return goCaptchaDialog(t,a);default:return defaultCaptchaDialog(t,a)}}function closeLoadingFunction(t){if(t&&typeof t=="object"&&typeof t.close=="function")t.close()}function goCaptchaDialog(resp,ajaxOptions){if(typeof resp.Data=="undefined"||typeof resp.Data.driver=="undefined"){showMsg({text:resp.Info,type:"error"});closeLoadingFunction(ajaxOptions);return false}if(typeof ajaxOptions.postByCaptchaDialog!="undefined"&&ajaxOptions.postByCaptchaDialog){showMsg({text:resp.Info,type:"error"})}var captchaName=resp.Data.captchaName,htmlCode=resp.Data.html;jsInit=resp.Data.jsInit;for(var i=0;i<resp.Data.cssURLs.length;i++){var cssURL=resp.Data.cssURLs[i];if(cssURL&&$('link[href*="'+cssURL+'"]').length<1){$("head").append('<link rel="stylesheet" href="'+ASSETS_URL+cssURL+"?t="+BUILD_TIME+'">')}}for(var i=0;i<resp.Data.jsURLs.length;i++){var jsURL=resp.Data.jsURLs[i];if(jsURL&&$('script[src*="'+jsURL+'"]').length<1){$("body").append('<script src="'+ASSETS_URL+jsURL+"?t="+BUILD_TIME+'" type="text/javascript"><\/script>')}}var formHTML='<form method="post" id="dialog-retry-captcha">        '+htmlCode+"    </form>";var done=function(t){var a=$("#dialog-retry-captcha");var e=a.find('[name="'+captchaName+'"]').val();postCaptchaDialogData(resp,ajaxOptions,e,null,captchaName,null);t.close()};App.dialog().show({title:App.t("行为验证"),type:"type-primary",size:"size-small",message:formHTML,nl2br:false,onshown:function(d){d.$modalDialog.css({"max-width":"340px",width:"340px"});if(d.$modalBody.length>0)d.$modalBody[0].style.setProperty("padding","0px","important");var $input=$("#dialog-retry-captcha").find('[name="'+captchaName+'"]');if(!$input.hasClass("wg-cap-static"))$input.addClass("wg-cap-static");if(jsInit){eval("var initCaptchaGo="+jsInit);initCaptchaGo(function(){App.message({text:App.t("验证成功"),type:"success"});done(d)});d.$modalBody.find(".wg-cap-wrap").css({border:0,"border-top-left-radius":0,"border-top-right-radius":0})}},onhide:function(t){closeLoadingFunction(ajaxOptions)}});return true}function apiCaptchaDialog(resp,ajaxOptions){if(typeof resp.Data=="undefined"||typeof resp.Data.provider=="undefined"){showMsg({text:resp.Info,type:"error"});closeLoadingFunction(ajaxOptions);return false}if(typeof ajaxOptions.postByCaptchaDialog!="undefined"&&ajaxOptions.postByCaptchaDialog){showMsg({text:resp.Info,type:"error"})}var jsURL=resp.Data.jsURL,captchaName=resp.Data.captchaName,captchaIdent=resp.Data.captchaIdent,htmlCode=resp.Data.html,jsInit=resp.Data.jsInit;if(jsURL&&$('script[src="'+jsURL+'"]').length<1){$("body").append('<script src="'+jsURL+'" type="text/javascript"><\/script>')}var formHTML='<form method="post" id="dialog-retry-captcha">        <div class="form-group mg-b-0" style="position:relative">            <div class="captcha-loading text-center" id="'+resp.Data.locationID+'-loading" style="position:relative"><i class="fa fa-spinner fa-spin"></i> '+App.t("验证加载中，请稍候...")+'</div>            <div style="position:relative;z-index:2;margin-top:-20px;min-height:20px">'+htmlCode+"</div>        </div>\x3c!-- form-group --\x3e    </form>";var done=function(t){var a=$("#dialog-retry-captcha");var e=a.find('[name="'+captchaName+'"]').val();var n=a.find('[name="'+captchaIdent+'"]').val();postCaptchaDialogData(resp,ajaxOptions,e,n,captchaName,captchaIdent);t.close()};App.dialog().show({title:App.t("人机验证"),type:"type-primary",size:"size-small",message:formHTML,nl2br:false,closeByBackdrop:false,onshown:function(d){if(jsInit)eval(jsInit);$("#dialog-retry-captcha").on("submit",function(t){t.preventDefault();d.getButton("captchaDialogBtnSubmit").trigger("click")})},onhide:function(t){closeLoadingFunction(ajaxOptions)},buttons:[{id:"captchaDialogBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:done},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close();closeLoadingFunction(ajaxOptions)}}]});return true}function defaultCaptchaDialog(n,o){if(typeof n.Data=="undefined"||typeof n.Data.captchaURL=="undefined"){showMsg({text:n.Info,type:"error"});closeLoadingFunction(o);return false}if(typeof o.postByCaptchaDialog!="undefined"&&o.postByCaptchaDialog){showMsg({text:n.Info,type:"error"})}var i=n.Data.captchaName,t=n.Data.captchaURL;var a=n.Data.captchaID,r=n.Data.captchaIdent;var e='<form method="post" id="dialog-retry-captcha">        <div class="form-group mg-b-0">            <div class="input-group">              <input type="text" placeholder="'+App.t("图像验证码")+'" value="" name="'+i+'" required="required" data-toggle="tooltip" title="'+App.t("请输入验证码")+'" class="form-control" id="dialog-captcha-code">              <span class="input-group-addon pd-0"><img id="captchaImage" src="'+t+"\" alt=\"Captcha image\" onclick=\"this.src=this.src.split('?')[0]+'?reload='+Math.random();\" onerror=\"if(this.src.indexOf('?reload=')!=-1 && confirm('"+App.t("页面验证码已经失效，必须重新请求当前页面。确定要刷新本页面吗？")+'\')) window.location.reload();" style="cursor:pointer"><input type="hidden" id="dialog-captcha-id" name="'+r+'" value="'+a+'"></span>            </div>            <small id="dialog-captcha-code-help" class="form-text text-muted">'+App.t("请输入图片上显示的验证码")+"</small>        </div>\x3c!-- form-group --\x3e    </form>";App.dialog().show({title:App.t("操作验证"),type:"type-primary",size:"size-small",message:e,nl2br:false,closeByBackdrop:false,onshown:function(a){var t=$("#dialog-captcha-code");t.focus();t.select();$("#dialog-retry-captcha").on("submit",function(t){t.preventDefault();a.getButton("captchaDialogBtnSubmit").trigger("click")})},onhide:function(t){closeLoadingFunction(o)},buttons:[{id:"captchaDialogBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(t){var a=$("#dialog-captcha-code").val();var e=$("#dialog-captcha-id").val();postCaptchaDialogData(n,o,a,e,i,r);t.close()}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close();closeLoadingFunction(o)}}]});return true}function postCaptchaDialogData(t,a,e,n,o,i){var r="ajaxFormObject"in a&&a.ajaxFormObject;var s=t.Zone||o;if(!r||s&&$(a.ajaxFormObject).find('[name="'+s+'"]').length<1){if(!a.data)a.data={};switch(typeof a.data){case"string":a.data+="&"+o+"="+encodeURIComponent(e);if(i)a.data+="&"+i+"="+encodeURIComponent(n);break;default:if($.isArray(a.data)){var l=false,c=false;var p={name:o,value:e};var d=i?{name:i,value:n}:null;for(var f=0;f<a.data.length;f++){if(a.data[f].name==o){a.data[f]=p;l=true}if(i){if(a.data[f].name==i){a.data[f]=d;c=true}if(c&&l)break}else{if(l)break}}if(!c&&d)a.data.push(d);if(!l)a.data.push(p);break}a.data[o]=e;if(i)a.data[i]=n}}a.postByCaptchaDialog=true;closeLoadingFunction(a);if(r){var u=$(a.ajaxFormObject);var m=u.find('[name="'+o+'"]');if(m.length>0){m.val(e);if(i)u.find('[name="'+i+'"]').val(n)}u.trigger("submit")}else{$.ajax(a)}}function signInDialog(a,t){if($("#modal-sign-in").length>0)return $("#modal-sign-in").modal("show");$.get("/sign_in",{modal:1,next:window.location.href},function(t){$("body").append(t);closeLoadingFunction(t);if(a!=null&&$.isFunction(a)){$("#modal-sign-in-form").data("callback",function(){$("#modal-sign-in").modal("hide");return a.apply(this,arguments)})}$("#modal-sign-in").modal("show");$("#modal-sign-in").on("shown.bs.modal",function(){$("#modal-sign-in-form").find('input[name="name"]').focus()})},"html").fail(function(){closeLoadingFunction(t)})}function inputVerifyCode(t,i,r,s){if(r==null)r=window.location.href;var a='<form method="post" id="dialog-vcode-form">  <div class="form-group mg-b-0">    <input type="text" placeholder="'+App.t("请输入%s验证码",t)+'" value="" name="code" required="required" data-toggle="tooltip" title="'+App.t("请输入%s验证码",t)+'" class="form-control" id="dialog-input-vcode">    <small id="dialog-input-vcode-help" class="form-text text-muted">'+App.t("请输入您接收到的%s验证码",t)+"</small>  </div></form>";App.dialog().show({title:App.t("请输入%s验证码",t),type:"type-primary",size:"size-small",message:a,nl2br:false,closeByBackdrop:false,onshown:function(a){var t=$("#dialog-input-vcode");t.focus();t.select();$("#dialog-vcode-form").on("submit",function(t){t.preventDefault();a.getButton("inputVerifyCodeBtnSubmit").trigger("click")})},buttons:[{id:"inputVerifyCodeBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(a){var t=$("#dialog-input-vcode").val();var e;var n=function(){e.push({name:"vcode",value:t});e.push({name:"verify",value:1})};switch(typeof i){case"object":if(!$.isArray(i)){e={};for(var o in i){e[o]=i[o]}e["vcode"]=t;e["verify"]=1;break}e=[];for(var o=0;o<i.length;o++){e.push(i[o])}n();break;case"string":e=$(i).serializeArray();n();break;default:e=[];n();break}$.post(r,e,function(t){if(t.Code==1){a.close();App.message({text:t.Info,type:"success"});if(s!=null)return s.apply(this,arguments);window.setTimeout(function(){window.location.reload()},2e3);return}App.message({text:t.Info,type:"error"})},"json")}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})}function authDialog(l,c,p,d){if(d==null)d=window.location.href;$.get(BASE_URL+"/user/profile/_authentication",{type:l},function(t){var a=t.Data.html;var e=App.t("验证密码"),n="check";var s=t.Data.waitingSeconds;switch(t.Data.type){case"email":e=App.t("发送邮件");n="paper-plane";break;case"mobile":e=App.t("发送短信");n="paper-plane";break}App.dialog().show({id:"authentication-dialog",title:App.t("身份验证"),type:"type-primary",message:a,nl2br:false,closeByBackdrop:false,enableScript:true,onshown:function(t){var a=$("#authentication-form");var e=a.find("input:not(readonly):first");e.focus();e.select();a.prev("ul.nav").find("a.nav-link").on("click",function(){authDialog($(this).data("type"),$(this).data("object-name"),p,d);t.close()})},buttons:[{id:"authentication-btn-submit",label:e,icon:"fa fa-"+n,cssClass:"btn-primary mg-r-10",action:function(a){var e=this;var n=$(p).serializeArray();var t=$("#authentication-form").serializeArray();for(var o=0;o<t.length;o++)n.push(t[o]);var i=d.indexOf("?")==-1?"?":"&";var r=l=="password"?"verify":"send";if(r=="send")btnDisabled(e,'<i class="fa fa-spinner fa-spin"></i> '+App.t("发送中，请稍候..."));$.post(d+i+"step="+r,n,function(t){if(r=="send")btnEnabled(e);renewCaptcha("#authentication-form",t);if(t.Code!=1)return App.message({text:t.Info,type:"error"});if(r=="send")waiting(e,s);if(t.Data.nextStep=="verify"){App.message({text:t.Info+","+App.t("请输入您收到的验证码"),type:"success"});return inputVerifyCode(c,n,d+i+"step=verify",function(){a.close()})}App.message({text:t.Info,type:"success"});a.close()},"json")}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})},"json")}function commentList(t,a,e,n){if(t==null)t=1;if(a==null)a="#comment-list-container";if(n==null)n=false;var o=$(a);if(!o||o.length<1)return;if(e==null)e=o.data("url");if(!e)return;loadCommentList(o,e,{page:t,html:1,_pjax:"true"},n,$("#headPanel").height()+90)}function loadCommentList(a,t,e,n,o){$.get(t,e||{},function(t){if(t.Code!=1)return showMsg(t.Info);a.html(t.Data.html);bindCommentList(a,n,o);if(!n&&t.Data.pagination){$(".comment-count-num").text(t.Data.pagination.rows)}},"json")}function bindCommentList(a,e,n){if(!a||a.length<1)return;if(n===null)n=0;if(e===null)e=false;var o=a.data("replace-state")||false;a.find("[data-reply-id]").on("click",function(){var t=$(this).data("reply-id");var a=$("#reply-list-box-"+t);commentList(1,a[0],a.data("url"),true)});attachContype(a);a.find("[data-comment-like-id]").on("click",function(){var t=$(this).data("comment-like-id"),e=$(this);$.post(BASE_URL+"/article/comment_like",{id:t},function(t){if(t.Code<1){App.message({text:t.Info,type:"error"});return}e.removeClass("tx-gray-light").addClass("tx-success");var a=e.find(".comment-likes");if(a.length>0){a.text(a.text()*1+1)}},"json")});a.find('.pagination a[data-pjax="true"]').on("click",function(t){t.preventDefault();if(o)App.replaceState(null,"",$(this).attr("href"));loadCommentList(a,$(this).attr("href"),null,e,n);$("html, body").animate({scrollTop:a.offset().top-n},0)})}function initCommentForm(o){if(o==null)o="#comment-post-form";if($(o).length<1)return;if($(o).data("attached"))return;$(o).data("attached",true);$(o).find("[required]").on("keyup blur",function(){var t=$.trim($(this).val());if(t==""){$(this).addClass("form-control-warning").parent().addClass("has-warning")}else{$(this).removeClass("form-control-warning").parent().removeClass("has-warning")}});var a=function(){var t=$(o).find(".form-control-warning[required]");if(t.length>0){t.focus();showMsg(t.attr("placeholder"));return}var a=$(o).attr("action");var e=true;$(o).find("[required]").each(function(){var t=$.trim($(this).val());if(t==""){if(e){$(this).focus();showMsg($(this).attr("placeholder"))}e=false;$(this).addClass("form-control-warning").parent().addClass("has-warning")}});if(!e)return;$.post(a,$(o).serializeArray(),function(t){renewCaptcha($(o),t);showMsg(t.Info);if(t.Code>0){if($(".show-after-comment.mission-uncompleted").length>0){window.setTimeout(function(){window.location.reload()},2e3);return}if(/^modal-/.test($(o).attr("id"))){$(o).parents(".modal").modal("hide")}var a=$(o).find("#reply-id");var e=a.data("root-id")||0;if(e&&$("#reply-list-box-"+e).length>0){var n=$("#reply-list-box-"+e);commentList(1,n[0],n.data("url"),true)}else{commentList(1)}$(o).find("[name=content]").val("");$(o).find("[name=code]").val("")}},"json")};$(o).on("submit",function(t){t.preventDefault();a.apply(this,arguments)});$(o).find("[data-form]:not(:submit)").on("click",a)}function initPageAllCommentForm(){initCommentForm();initCommentForm("#modal-comment-post-form");$("#modal-comment-form").on("show.bs.modal",function(t){var a=$(t.relatedTarget);var e=a.data("comment-id")||"0";var n=a.data("root-id")||"0";var o=$(this);var i=o.find("#reply-id");i.val(e);i.data("root-id",n);var r=o.find("#reply-comment-blockquote");if(e>0){r.show();r.find("#reply-comment-content").html($(a.data("comment-content")).html());r.find("#reply-comment-author").html(a.data("comment-author"))}else{r.hide();r.find("#reply-comment-content").html("");r.find("#reply-comment-author").html("")}})}function follow(a){var t=$(a).data("following-uid");var e={uid:t};var n=$(a).hasClass("btn-outline-primary");if(!n)e["unfollow"]=1;$.post(BASE_URL+"/user/profile/following",e,function(t){if(t.Code<1){showMsg({text:t.Info,type:"error"});if(t.Code==App.status.NotLoggedIn)window.location.href=t.URL+"?next=".encodeURLComponent(window.location.href);return}showMsg({text:t.Info,type:"success"});if(n){$(a).removeClass("btn-outline-primary").addClass("btn-outline-gray-lighter active");$(a).text($(a).data("i18n-followed"))}else{$(a).removeClass("btn-outline-danger").removeClass("btn-outline-gray-lighter active").addClass("btn-outline-primary");$(a).text($(a).data("i18n-following"))}},"json")}function setFollowStatus(a){var t=$(a).data("following-uid");if(t==CUSTOMER.ID){return $(a).replaceWith("<small>"+App.t("这是我")+"</small>")}$.post(BASE_URL+"/user/profile/is_followed",{uid:t},function(t){if(t.Code>0){$(a).removeClass("btn-outline-primary").addClass("btn-outline-danger");$(a).text($(a).data("i18n-unfollow"))}},"json")}function btnDisabled(t,a){var e=t.data("original-innerhtml");if(!e){e=t.html();t.data("original-innerhtml",e)}t.prop("disabled",true);t.html(a)}function btnEnabled(t){var a=t.data("original-innerhtml");t.html(a);t.prop("disabled",false)}function waiting(t,a){if(t.prop("disabled"))return;if(a==null)a=60;var e="timedown-"+String(Math.random()).replace(".","");btnDisabled(t,'<i class="fa fa-spinner fa-spin"></i> <span id="'+e+'">'+a+App.t("秒后可重试")+"</span>");var n=$("#"+e);var o=a;var i=window.setInterval(function(){o--;if(o<=0){window.clearInterval(i);btnEnabled(t);return}n.text(o+App.t("秒后可重试"))},1e3)}function countWords(t,a){if(a==null){var e=$(t).attr("id"),n=$(t).attr("name");if($("#"+e+"WordsCount").length>0)a="#"+e+"WordsCount";else if($("#"+n+"WordsCount").length>0)a="#"+n+"WordsCount";else throw"Variable countElem is undefined"}$(a).text(Number($(t).attr("maxlength"))-$(t).val().length)}function checkSubmitBtnWithCloser(t){var a=$(t).find(":submit"),e=function(){};if(a.length>0){if(a.prop("disabled"))return{submited:true,close:e};var n=a.children(".fa");a.prop("disabled",true);if(n.length>0)n.addClass("fa-refresh fa-spin");e=function(){a.prop("disabled",false);if(n.length>0)n.removeClass("fa-refresh fa-spin")}}return{submited:false,close:e}}function ajaxForm(e,a,n){var o=$(e).find(":submit"),t=function(){};if(o.length>0){t=function(){o.prop("disabled",false);var t=o.children(".fa");if(t.length>0)t.removeClass("fa-refresh fa-spin")}}var i={ajaxFormObject:e,type:String($(e).attr("method")).toLowerCase()=="post"?"post":"get",dataType:"json",data:{},url:$(e).attr("action"),close:t,beforeSubmit:function(){var t=$(e).find(":submit");if(t.length>0){if(t.prop("disabled"))return false;t.prop("disabled",true);var a=t.children(".fa");if(a.length>0)a.addClass("fa-refresh fa-spin")}return true},success:function(t){i.data={};if("postByCaptchaDialog"in i)delete i.postByCaptchaDialog;onAjaxRespond(e,t,i,a,n)},error:function(t){cc.close()}};$(e).ajaxForm(i)}function onAjaxRespond(t,a,e,n,o){if(a.Code==1){renewCaptcha(t,a);if(n!=null&&$.isFunction(n))n(a);closeLoadingFunction(e);t.reset();return showMsg({text:a.Info,type:"success"})}if(a.Code==App.status.NotLoggedIn){return signInDialog(function(){},e)}if(App.captchaHasError(a.Code))return captchaDialog(a,e);showMsg({text:a.Info,type:"error"});renewCaptcha(t,a);if(o!=null&&$.isFunction(o))o(a);closeLoadingFunction(e)}function hasScroll(t,a){var e=!a||a==="vertical"?"scrollTop":"scrollLeft";var n=!!t[e];if(!n){t[e]=1;n=!!t[e];t[e]=0}return n}function complaint(e,n){var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/complaint";var o={url:a,type:"POST",data:t,dataType:"json",close:n,success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&$(e).find('input[name="'+t.Zone+'"]').length<1){return captchaDialog(t,o)}n();showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}n();showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments)},error:function(t){n()}};$.ajax(o)}function complaintModal(t,r){var a=$(t).data("complaint-url");if(!a)return;var e=$(t).data("complaint-name");var n=$(t).data("complaint-types")||[];var o="";for(var i=0;i<n.length;i++){var s=n[i],l=i==0?' checked="checked"':"";o+='<label class="custom-control custom-radio">        <input type="radio" class="custom-control-input" value="'+s.K+'" name="type"'+l+'>        <span class="custom-control-indicator"></span>        <span class="custom-control-description">'+s.V+"</span>    </label>"}var c='<form method="post" id="dialog-complaint-form" action="'+a+'">  <div class="form-group mg-b-0">'+o+'</div>  <div class="form-group mg-b-0">    <textarea placeholder="'+App.t("投诉内容")+'" value="" name="content" required="required" data-toggle="tooltip" title="'+App.t("请输入投诉内容")+'" class="form-control" id="dialog-input-complaint-content"></textarea>    <small id="dialog-input-complaint-content-help" class="form-text text-muted">'+App.t("请输入投诉内容")+"</small>  </div></form>";App.dialog().show({title:App.t("投诉《%s》",e),type:"type-primary",size:"size-middle",message:c,nl2br:false,closeByBackdrop:true,onshown:function(a){var t=$("#dialog-input-complaint-content");t.focus();t.select();$("#dialog-complaint-form").on("submit",function(t){t.preventDefault();a.getButton("complaintFormBtnSubmit").trigger("click")})},buttons:[{id:"complaintFormBtnSubmit",label:App.t("提交"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(a){var t=$("#complaintFormBtnSubmit"),e=t.children(".fa");if(t.prop("disabled"))return;var n=$("#dialog-input-complaint-content");var o=$.trim(n.val());if(o==""){showMsg({text:App.t("请输入投诉内容"),type:"warning"});return}n.val(o);$("#dialog-complaint-form").data("callback",function(t){if(t.Code==1){a.close();if(r!=null)return r.apply(this,arguments)}});t.prop("disabled",true);e.addClass("fa-refresh fa-spin");var i=function(){t.prop("disabled",false);e.removeClass("fa-refresh fa-spin")};complaint("#dialog-complaint-form",i)}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})}function forgotModal(t,d){var f=$(t).data("submit-url");var a=$(t).data("form-tmpl");var u=$(t).data("name-sync");if(!f)return;var e="dialog-recv-recover-code-form",m="#"+e;var n='<form method="post" id="'+e+'" action="'+f+'">';n+=$(a).html();n+="</form>";App.dialog().show({title:App.t("找回密码：获取验证码"),type:"type-primary",size:"size-middle",message:n,nl2br:false,closeByBackdrop:true,onshown:function(a){var t=$(m);if(u){var e=$(u).val();if(e)t.find('input[name="name"]').val(e)}var n=t.find("input[type=text]:first");n.focus();n.select();t.on("submit",function(t){t.preventDefault();a.getButton("recvRecoverCodeFormBtn").trigger("click")});t.find("select[name=type]").off().on("change",function(){switch($(this).val()){case"mobile":t.find("input[name=account]").attr("placeholder",App.t("手机号码"));break;default:t.find("input[name=account]").attr("placeholder",App.t("E-mail地址"));break}})},buttons:[{id:"recvRecoverCodeFormBtn",label:App.t("发送"),icon:"fa fa-check",cssClass:"btn-primary mg-r-10",action:function(e){var t=$("#recvRecoverCodeFormBtn"),a=t.children(".fa");if(t.prop("disabled"))return;t.prop("disabled",true);a.addClass("fa-refresh fa-spin");var n=function(){t.prop("disabled",false);a.removeClass("fa-refresh fa-spin")};var o=["name","account"];for(var i=0;i<o.length;i++){var r=o[i];var s=$(m).find('input[name="'+r+'"]');var l=$.trim(s.val());if(l==""){var c="";switch(r){case"name":c=App.t("请输入用户名");break;case"account":c=App.t("请输入%s",s.attr("placeholder"));break;default:c=r}showMsg({text:c,type:"warning"});s.focus();n();return}s.val(l)}var p={url:f,type:"POST",data:$(m).serializeArray(),dataType:"json",close:n,success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&$(m).find('input[name="'+t.Zone+'"]').length<1){return captchaDialog(t,p)}n();showMsg({text:t.Info,type:"error"});return renewCaptcha(m,t)}showMsg({text:t.Info,type:"success"});if(u){var a=$(m);$(u).val(a.find('input[name="name"]').val())}if(d!=null){d.apply($(m),arguments)}e.close();n()},error:function(t){n()}};$.ajax(p)}},{label:App.t("取消"),icon:"fa fa-times",action:function(t){t.close()}}]})}function openForgotModal(t){forgotModal(t,function(t){$("#recvType").val(this.find("select[name=type]").val());$("#recvAccount").val(this.find("input[name=account]").val())})}function resetPassword(e,n){var t=$(e).serializeArray();var a=$(e).attr("action")||BASE_URL+"/forgot";var o={url:a,type:"POST",data:t,dataType:"json",success:function(t){if(t.Code!=1){if(App.captchaHasError(t.Code)&&$(e).find('input[name="'+t.Zone+'"]').length<1){return captchaDialog(t,o)}showMsg({text:t.Info,type:"error"});return renewCaptcha(e,t)}showMsg({text:t.Info,type:"success"});var a=$(e).data("callback");if(a&&$.isFunction(a))return a.apply(this,arguments);window.setTimeout(function(){if(!n||n.indexOf("/forgot")>=0)n="/index";window.location.href=n},2e3)},error:function(t){}};$.ajax(o)}function getColorByRandom(t){var a=Math.floor(Math.random()*t.length);var e=t[a];t.splice(a,1);return e}function tagsRandomColor(t,a){if(!t)t=".tags-container > .tag-item";if(a==null)a=0;var e=["orange","coral","darkorange","darksalmon","hotpink","#9dc6eb","#f8c471","#b9a3ef","#fdb1ca","#9dc6eb","#f8c471","#b9a3ef","#fdb1ca"];var n=$(t);var o=n.length;for(var i=a;i<o;i++){var r=getColorByRandom(e);n.eq(i).css("background-color",r)}}function backLastPage(t){if(t==null){window.location.href=document.referrer;return}window.history.go(t)}function setNavActive(){var t=$("#navbarMain .active");if(t.length<1)return;while(true){var a=t.attr("class");if(t.hasClass("dropdown-item")){t=t.closest(".dropdown-menu").prev("a:not(.active)")}else{t=t.closest("ul").prev("a:not(.active)")}if(t.length<1)return;if(t.hasClass("nav-link"))return t.addClass("active");t.addClass(a)}}function attachContype(t){if(typeof App.editor==="undefined")return;App.editor.attachContype(t)}function commonInit(t,a){if(window.errorMSG)a.message({title:a.i18n.SYS_INFO,text:a.ifTextNl2br(window.errorMSG),class_name:"danger"});if(window.successMSG)a.message({title:a.i18n.SYS_INFO,text:a.ifTextNl2br(window.successMSG),class_name:"success"});t(function(){t('[data-toggle="tooltip"]:not(data-original-title)').tooltip();t("[data-following-uid]").each(function(){setFollowStatus(this)});t("textarea[count-words]").on("keyup",function(){countWords(this,t(this).attr("count-words"))}).trigger("keyup");t("form[ajax-submit]").each(function(){ajaxForm(this)});a.fixedFooter(".footer-fix");a.bottomFloat(".auto-bottom-float",0,true);a.showRequriedInputStar();setNavActive();attachContype();t.post(FRONTEND_URL+"/customer_info",{},function(t){if(t.Code!=1)return;CUSTOMER.ID=t.Data.id;CUSTOMER.NAME=t.Data.name;a.notifyListen(FRONTEND_URL+"/user/notice");if(typeof a.onCustomterInfo=="function"){a.onCustomterInfo(t.Data)}})})}if(typeof jQuery!=="undefined"&&typeof App!=="undefined"){commonInit(jQuery,App)}