{{Extend "user/base"}}
{{Block}}
{{/Block}}
{{Block "body"}}
{{Super}}
<div class="main mg-lg-l-240 pd-t-70 pd-lg-t-75">
  <div class="main-header pd-x-20 pd-y-30 bg-white d-sm-flex align-items-center justify-content-between">
    <h5 class="tx-inverse tx-bold mg-b-0">{{"扫码二维码"|$.T}}</h5>
    <nav class="breadcrumb pd-0 bg-transparent mg-b-0 tx-size-12 mg-t-5 mg-sm-t-0">
      <a class="breadcrumb-item" href="{{FrontendURL}}/user/index">{{"用户中心"|$.T}}</a>
      <span class="breadcrumb-item active">{{"扫码二维码"|$.T}}</span>
    </nav>
  </div>

  <div class="main-body pd-20">
<div class="row">
  <div class="col-lg-12 mg-t-0">
    <div class="card card-table">
      <div class="card-header">
        <h6 class="card-title">{{"扫码二维码"|$.T}}</h6>
      </div><!-- card-header -->
      <div><style>#qr-reader{border:0 !important;}</style>
        <div id="qr-reader" style="border:0 !important"></div>
        <div id="qr-reader-results"></div>
      </div>
    </div><!-- card -->
  </div><!-- col-6 -->
</div><!-- row -->
    </div><!-- main-body -->
</div><!-- main -->
{{/Block}}

{{Block "footer"}}
{{Super}}
<script src="{{AssetsXURL}}/js/qrcode/html5-qrcode.min.js" charset="utf-8"></script>
<script>
//var resultContainer = document.getElementById('qr-reader-results');
function onScanSuccess(decodedText, decodedResult) {
    $.post(FRONTEND_URL+'/user/qrcode/scan',{data:decodedText},function(r){
        if(r.Code!=1)return App.message({text:r.Info,type:'error'});
        return App.message({text:r.Info,type:'success'});
    },'json')
}
var html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", {fps: 10, qrbox: 250, cameraPermissionTitle: function(){
    return "Test";
}});
html5QrcodeScanner.render(onScanSuccess);
</script>
{{/Block}}
