{{Extend "user/base"}}
{{Block "head"}}
{{Super}}
<link rel="stylesheet" type="text/css" href="{{AssetsURL}}/js/jquery.select2/select2.css?t={{BuildTime}}" />
<link rel="stylesheet" type="text/css" href="{{AssetsURL}}/js/selectpage/selectpage.css?t={{BuildTime}}" />
{{/Block}}
{{Block "body"}}
{{Super}}
{{- $data := $.Stored.forms.Model -}}
<div class="main mg-lg-l-240 pd-t-70 pd-lg-t-75">
  <div class="main-header pd-x-20 pd-y-30 bg-white d-sm-flex align-items-center justify-content-between">
    <h5 class="tx-inverse tx-bold mg-b-0">{{$.Stored.title}}</h5>
    <nav class="breadcrumb pd-0 bg-transparent mg-b-0 tx-size-12 mg-t-5 mg-sm-t-0">
      <a class="breadcrumb-item" href="{{FrontendURL}}/user/index">{{"用户中心"|$.RawT|UpperCaseFirst|$.ExtT}}</a>
      <span class="breadcrumb-item active">{{$.Stored.title}}</span>
    </nav>
  </div>

  <div class="main-body pd-20">
    <div class="row">
      <div class="col-lg-12 mg-t-0">
        <div class="card card-form">
          <div class="card-header">
            <a class="btn btn-info pull-right" href="{{FrontendURL}}/user/article/list">{{"返回列表"|$.T}}</a>
            <h6 class="card-title">{{$.Stored.title}}</h6>
          </div><!-- card-header -->
          <div class="card-body card-body-pd-lg">
            <form class="form form-label-right" method="POST">
              <div class="form-group row">
                <label class="col-md-2 col-form-label">{{"封面图"|$.T}}:</label>
                <div class="col-md-8">
                  <div class="avatar-upload">
                    {{- $image := $data.Image -}}
                    <img src="{{$image|Default (AssetsURL `/images/user_128.png`)}}"
                      class="profile-avatar img-thumbnail" onerror="this.src='{{AssetsURL}}/images/user_128.png';" />
                    <input id="fileupload" type="file" name="files[]" data-prefix="article">
                    <input type="hidden" id="article-image" name="image" value="{{$image}}" />
                    <input type="hidden" id="article-image-original" name="imageOriginal" value="{{$data.ImageOriginal}}" />
                    <div id="article-progress" class="overlay"></div>
                  </div>
                </div>
              </div>
              {{- $.Stored.forms.Render -}}
              <div class="form-group row">
                <div class="col-md-10 mg-t-5 offset-sm-2">
                  <button type="submit" class="btn btn-primary">
                    <i class="fa fa-save"></i>
                    {{"保存"|$.T}}
                  </button>
                  {{if $.Stored.isEdit}}
                  <span class="text-warning mg-l-20">{{`提交后需要重新审核`|$.T}}</span>
                  {{end}}
                </div>
              </div>
            </form>
            {{- $.Set `cropImageModalPrefix` `article` -}}
            {{Include "modal_crop_image"}}
          </div><!-- card-body -->

        </div><!-- card -->
      </div><!-- col-6 -->
    </div><!-- row -->
  </div><!-- main-body -->
</div><!-- main -->
{{/Block}}

{{Block "footer"}}
{{Super}}
<script src="{{AssetsURL}}/js/jquery.select2/select2.min.js?t={{BuildTime}}" type="text/javascript"></script>
<script src="{{AssetsURL}}/js/selectpage/selectpage.min.js?t={{BuildTime}}" type="text/javascript"></script>
<script src="{{AssetsURL}}/js/loader/loader.min.js?t={{BuildTime}}"></script>
<script src="{{AssetsURL}}/js/editor/editor.min.js?t={{BuildTime}}"></script>
<script src="{{AssetsURL}}/js/behaviour/page/select2.min.js?t={{BuildTime}}"></script>
<script type="text/javascript">
  $(function () {
    window.CropServerURL = '{{FrontendURL}}/user/file/crop';
    App.editor.cropImage('{{FrontendUploadURL ``}}', "#article-image", '#article-image-original');
    App.editor.multilingualContentEditor(null, '#content', '{{FrontendUploadURL ``}}');
    var tagList = {{ $.Stored.tagList| JSONEncode | ToJS}};
    App.select2.select('#select2tags', { multiple: true, data: tagList || [] });
});
</script>
{{/Block}}